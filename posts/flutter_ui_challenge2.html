<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="stylesheet" href="/styles/app.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.DgpY0UD5.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.TOmCngSk.css" rel="stylesheet">
		<link href="../_app/immutable/assets/ArticleMeta.VMQ7KKaF.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.BMziCj1o.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.B5VOJ3K0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.BR55WShb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CXVSoEhx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DhY4kAqZ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.DZHVcTXD.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.CPUqzy8s.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/each.D6YF6ztN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/header.vhBZ3ANe.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.Bkkj0y1T.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CzR0xuCU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PageHead.DxCapelc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/ArticleMeta.B7E3AiTX.js"><title>Flutter UI Challenge(2) | yesj1234.github.io</title><!-- HEAD_svelte-1jfag13_START --><meta property="og:site_name" content="yesj1234.github.io"><meta property="og:title" content="Flutter UI Challenge(2)"><meta property="og:description" content="Learn how to use StatefulWidgets and animate the changes of Widget. Widgets related to animations are Animation, AnimationController, Tween, AnimatedWidget and etc.."><!-- HEAD_svelte-1jfag13_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">  <div class="sidebar-and-main svelte-1cahsd9"><div class="sidebar2 svelte-1cahsd9"><div class="container svelte-76a3v9"><div class="sidebar svelte-76a3v9"><div class="menu svelte-76a3v9"><button type="button" class="menu-item svelte-76a3v9" data-svelte-h="svelte-4rz7h9"><i class="fa-regular fa-copy"></i></button> <div class="menu-item svelte-76a3v9" data-svelte-h="svelte-608ww5"><i class="fa-solid fa-magnifying-glass"></i></div> <button class="menu-item svelte-76a3v9" data-svelte-h="svelte-1fo943y"><a href="/"><i class="fa-solid fa-house"></i></a></button></div></div> <div class="sidebar-folders svelte-76a3v9 closed" style="width: 0px; transition: width 0.3s ease;"><button class="root-folder svelte-76a3v9"><div class="root-folder-title svelte-76a3v9"><span class="arrow-icon svelte-76a3v9" data-svelte-h="svelte-w8ixat"><i class="fa-solid fa-chevron-right"></i></span> <span class="root-folder svelte-76a3v9" data-svelte-h="svelte-1ag9bxk">YESJ1234.GITHUB.IO</span></div></button> </div> </div></div> <div class="main svelte-1cahsd9"><div class="header-container svelte-1cahsd9"><div><div class="container svelte-18ebzw"></div> </div></div> <div class="container svelte-1iv6ft1"><div class="metadata svelte-1iv6ft1"> <h2 class="heading svelte-1ujuesn large" id="flutter-ui-challenge"><a href="#flutter-ui-challenge">Flutter UI Challenge(2)</a></h2> <p class="svelte-1uy9i9h"><div class="tags svelte-1uy9i9h"><span data-svelte-h="svelte-190wkx9">Tags:</span> <div class="tag-items-container svelte-1uy9i9h"><span class="tag svelte-1uy9i9h">Flutter</span></div></div></p> <div class="metadata svelte-1uy9i9h"><span class="date svelte-1uy9i9h">2024. 10. 07. (Mon)</span> </div></div> <div class="component svelte-1iv6ft1"><nav class="toc" data-svelte-h="svelte-15psssa"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#cloning-radial-countdown-timer">Cloning Radial Countdown Timer</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#prerequisites">Prerequisites</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#statefulwidgetabstract">StatefulWidget(abstract)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#custompaint">CustomPaint</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#custompainterabstract">CustomPainter(abstract)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#animationabstract">Animation(abstract)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#animationcontroller">AnimationController</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#tickerproviderabstract">TickerProvider(abstract)</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#ticker">Ticker</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#schedulerbindingmixin">SchedulerBinding(mixin)</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#schedulerbindingscheduleframecallbackmethod">SchedulerBinding.scheduleFrameCallback(method)</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tween">Tween</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#animatedwidget">AnimatedWidget</a></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#개선1-using-prebuilt-animation-widget-circularprogressindicator">개선1. Using prebuilt animation widget (CircularProgressIndicator)</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#개선2-refactoring-with-animatedbuilder">개선2. Refactoring with AnimatedBuilder</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#개선3-using-ticker-instead-of-timer-counter">개선3. Using Ticker instead of Timer (Counter)</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#sources">Sources</a></li></ol></nav> <h1 id="cloning-radial-countdown-timer" data-svelte-h="svelte-1uwbuaz">Cloning Radial Countdown Timer</h1> <p data-svelte-h="svelte-2igdr6"><img src="/timer.png" alt="timer"></p> <p data-svelte-h="svelte-vu63zp">2번째로 구현해볼 것은 위와 같은 디자인의 카운트 다운 타이머입니다.</p> <p data-svelte-h="svelte-bsbd7b">Restart버튼을 누르면 10초에서 0초까지 카운트다운이 시작되며 숫자를 감싸고 있는 원의 배경색이 시간에 맞춰 반시계 방향으로 변하는 애니메이션을 추가해주면 됩니다.</p> <p data-svelte-h="svelte-6ezo3s">구현에 앞서 다음의 Widget들에 대해 간단히 알아보도록 하겠습니다.</p> <ul data-svelte-h="svelte-7pxl38"><li><strong>StatefulWidget</strong></li> <li><strong>CustomPaint</strong> and <strong>CustomPainter</strong></li> <li><strong>Animation</strong></li> <li><strong>AnimationController</strong></li> <li><strong>Tween</strong></li> <li><strong>AnimatedWidget</strong></li> <li><strong>Timer</strong></li> <li><strong>Ticker</strong></li></ul> <h1 id="prerequisites" data-svelte-h="svelte-1vkztpa">Prerequisites</h1> <h2 id="statefulwidgetabstract" data-svelte-h="svelte-k6a4l1">StatefulWidget(abstract)</h2> <blockquote data-svelte-h="svelte-szg1rr"><p>A widget that has <strong>mutable</strong> state.
State is information that</p> <p>(1) <strong>can be read synchronously when the widget is built</strong> and</p> <p>(2) <strong>might change during the lifetime of the widget</strong>.</p> <p>It is the responsibility of the widget implementer to ensure the State is
Promptly notified when such state changes, using <strong>State.setState</strong>.</p> <p>…</p> <p>Stateful widgets are useful when the part of the user interface you are describing
can change dynamically, e.g. due to having an <strong>internal clock-driven state</strong>,
or <strong>depending on some system state</strong>.</p></blockquote> <ul data-svelte-h="svelte-1jmkus4"><li>StatelessWidget과는 달리 값이 변할 수 있는 <strong>state</strong>를 저장</li> <li><strong>state</strong>라 함은 (1) Widget 생성과 동시에 읽을 수 있는 값</li> <li>혹은 (2)Widget의 생애주기 상에서 변할 수 있는 값</li> <li>이 <strong>state</strong>가 언제 변할지는 개발자가 <strong>setState</strong>를 이용해 명시적으로 알려줘야함</li></ul> <p data-svelte-h="svelte-888uy3"><strong>How to use StatefulWidget Example</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Must override createState method.</span>
    <span class="token metadata function">@override</span>
    <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span><span class="token punctuation">></span></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CounterState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> _CounterState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// state to change over lifecycle of the widget.</span>
    <span class="token comment">// in this case we are changing the count using Timer.periodic</span>
    int _count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">Timer</span><span class="token operator">?</span> _timer<span class="token punctuation">;</span>
    <span class="token metadata function">@override</span>
    <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _timer <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">periodic</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Explicitly calling State.setState method to let the widget know</span>
            <span class="token comment">// the state has changed and mark the widget dirty.</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                _count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token metadata function">@override</span>
    <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        _timer<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">cancle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//Must override build method.</span>
    <span class="token metadata function">@override</span>
    <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
            width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">_count</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <h2 id="custompaint" data-svelte-h="svelte-cw8fyg">CustomPaint</h2> <blockquote data-svelte-h="svelte-1xzcqet"><p>A widget that provides a <strong>canvas</strong> on which to draw during the <strong>paint phase</strong>.</p> <p>When asked to paint, CustomPaint first asks its painter to paint on the current canvas,then, it paints its child, and then, after painting its child, it asks its foregroundPainter to paint.</p> <p>The <strong>coordinate system of the canvas</strong> matches the <strong>coordinate system of the CustomPaint object</strong>.
The painters are <strong>expected to paint within a rectangle</strong> starting at the origin and encompassing a region of the given size.(If the painters paint outside those bounds, there might be insufficient memory allocated to rasterize the painting commands and resulting behavior is undefined.)</p> <p>To enforce painting within those <strong>bounds</strong>, consider wrapping this CustomPaint with a <strong>ClipRect</strong> widget.</p> <p>Painters are implemented by subclassing <strong>CustomPainter</strong>.</p></blockquote> <ul data-svelte-h="svelte-lvc71r"><li><strong>Painter</strong>를 이용해 원하는 모형을 그릴 도화지(<strong>Canvas</strong>)를 제공하는 클래스라고 이해할 수 있음.</li> <li><a href="https://docs.flutter.dev/resources/architectural-overview#from-user-input-to-the-gpu" rel="nofollow">Rendering(Layout -&gt; Paint -&gt; Composition)</a>시 CustomPaint는 다음의 순서로 도형을 그려냄<ol><li><strong>painter</strong></li> <li><strong>child</strong></li> <li><strong>foreground painter</strong></li></ol></li></ul> <p data-svelte-h="svelte-7ev8ke"><strong>How to use CustomPaint</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token class-name">CustomPaint</span><span class="token punctuation">(</span>
    painter<span class="token punctuation">:</span> <span class="token class-name">Sky</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>
            <span class="token string-literal"><span class="token string">'Once upon a time...'</span></span><span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
                fontSize<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">,</span>
                fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>w900<span class="token punctuation">,</span>
                color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>white<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <h2 id="custompainterabstract" data-svelte-h="svelte-1uajjpx">CustomPainter(abstract)</h2> <blockquote data-svelte-h="svelte-1fht18o"><p>The <strong>interface</strong> used by <strong>CustomPaint</strong>(in the widgets library) and <strong>RenderCustomPaint</strong>(in the rendering library).</p> <p>To implement a custom painter, either <strong>subclass</strong> or <strong>implement this interface</strong> to define your custom paint delegate.
CustomPainter subclasses <strong>must implement</strong> the <strong>paint</strong> and <strong>shouldRepaint</strong> methods, and may optionally also implement the hitTest and shouldRebuildSemantics methods, and the semanticsBuilder getter.</p> <p>The paint method is called whenever the custom object needs to be repainted.</p> <p>The shouldRepaint method is called when a new instance of the class is provided, to check if the new instance actually represents different information.</p></blockquote> <ul data-svelte-h="svelte-1ctm0n0"><li><strong>CustomPaint</strong> 혹은 <strong>RenderCustomPaint</strong> 에서 사용되는 인터페이스(상세구현 필요)</li> <li><strong>paint</strong> 메서드와 <strong>shouldRepaint</strong> 메서드 필수로 구현.</li> <li>hitTest , shouldRebuildSemantics, semanticsBuilder 메서드 구현은 선택.</li></ul> <p data-svelte-h="svelte-4zg1un"><strong>How to use CustomPainter</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">Sky</span> <span class="token keyword">extends</span> <span class="token class-name">CustomPainter</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// paint method 구현 필수</span>
    <span class="token metadata function">@override</span>
    <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvs<span class="token punctuation">,</span> <span class="token class-name">Size</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 그림 그릴 도화지와 도화지의 사이즈</span>
        <span class="token keyword">final</span> <span class="token class-name">Rect</span> rect <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero <span class="token operator">&amp;</span> size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token class-name">RadialGradient</span> gradient <span class="token operator">=</span> <span class="token class-name">RadialGradient</span><span class="token punctuation">(</span>
            center<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            radius<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
            colors<span class="token punctuation">:</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0xFFFFFF00</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0xFF0099FF</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            stops<span class="token punctuation">:</span> <span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>
            rect<span class="token punctuation">,</span>
            <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>shader <span class="token operator">=</span> gradient<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Paint는 일종의 연필입니다.</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-xc6a6h">Sky는 다음과 같이 생긴 모형에 대해 묘사하는 클래스입니다.</p> <p data-svelte-h="svelte-n99mwl"><img src="/sky1.png" alt="Sky"></p> <h2 id="animationabstract" data-svelte-h="svelte-5mb67x">Animation(abstract)</h2> <blockquote data-svelte-h="svelte-tzqf3d"><p>An <strong>animation</strong> with a value of <strong>type T</strong>.</p> <p>An animation consists of a value (of type T) together with a <strong>status</strong>. The status indicates whether the animation is conceptually running from beginning to end or from the end back to the beginning, although the actual value of the animation might not change monotonically (e.g. if the animation uses a curve that bounces).</p> <p>Animations also <strong>let other object listen for changes</strong> to either their value or their status. These callbacks are called during the “animation” phase of the pipeline, just prior to rebuilding widgets.</p> <p>To create a new animation that you can run forward and backward, consider using <strong>AnimationController</strong>.</p></blockquote> <hr> <blockquote data-svelte-h="svelte-vnfisn"><p>In Flutter, an <strong>Animation object knows nothing about what is onscreen</strong>. An Animation is an abstract class that understands its current value and its state(completed or dismissed). One of the more commonly used animation types <strong>double</strong>.</p> <p>An Animation object sequentially generates interpolated numbers between two values over a cenrtain <strong>duration</strong>. The output of an Animation object might be linear, a curve, a step function, or any other mapping you can devise. Depending on how the Animation object is controlled, it could run in revesrse, or even switch directions in the middle.</p> <p>Animations can also interpolate types other than double, such as <strong>Color</strong> or <strong>Size</strong>.</p> <p>An Animation object knows nothing about rendering or build() functions.</p></blockquote> <ul data-svelte-h="svelte-crmuc3"><li><strong>Animation</strong>은 <strong>T</strong> 타입의 값과 <strong>상태</strong>(completed or dismissed와 같은)값을 갖는 클래스</li> <li>T 타입으로는 <strong>double</strong>이 일반적으로 많이 사용되고 <strong>Color</strong> 혹은 <strong>Size</strong> 같은 것들도 사용 가능함.</li> <li>animation이 실행되는 시간 간격(<strong>duration</strong>)을 정할 수 있음.</li> <li>animation은 실제 화면에 그려지는 세부사항에 대해서는 상관하지 않음.</li></ul> <h2 id="animationcontroller" data-svelte-h="svelte-shvwgy">AnimationController</h2> <blockquote data-svelte-h="svelte-1t755r5"><p>A controller for an animation.</p> <p>This class lets you perform tasks such as:</p> <ul><li>Play an animation forward or in reverse, or stop an animation.</li> <li>Set the animation to a specific value.</li> <li>Define the upperBound and lowerBound values of an animation.</li> <li>Create a fling animation effect using a physics simulation.</li></ul> <p>By default, an AnimationController linearly produces values that range from 0.0 to 1.0, during a given duration. The animation controller generates a new value whenever the device running your app is ready to display a new frame (typically, this rate is around 60 values per second).</p></blockquote> <ul data-svelte-h="svelte-1qjamrt"><li>AnimationController는 Animation 추상클래스를 상속받는 클래스.</li> <li>해당 animation을 컨트롤하기 위한 API들의 집합체</li> <li>animation을 재생(<strong>forward</strong>), 역재생(<strong>reverse</strong>), 멈추기(<strong>stop</strong>), 리셋(<strong>reset</strong>) 등의 메서드 제공</li> <li>animation value의 상한(upperBound), 하한(lowerBound)을 설정</li></ul> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">AnimationController</span> <span class="token keyword">extends</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> <span class="token keyword">with</span> <span class="token class-name">AnimationEagerListenerMixin</span><span class="token punctuation">,</span> <span class="token class-name">AnimationLocalListenersMixin</span><span class="token punctuation">,</span> <span class="token class-name">AnimationLocalStatusListenersMixin</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">AnimationController</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        double<span class="token operator">?</span> value<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reverseDuration<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>debugLabel<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lowerBound <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>upperBound <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animationBehavior <span class="token operator">=</span> <span class="token class-name">AnimationBehavior</span><span class="token punctuation">.</span>normal<span class="token punctuation">,</span>
        required <span class="token class-name">TickerProvider</span> vsync<span class="token punctuation">,</span> <span class="token comment">// WTF is this?</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">assert</span><span class="token punctuation">(</span>upperBound <span class="token operator">>=</span> lowerBound<span class="token punctuation">)</span><span class="token punctuation">,</span>
        _direction <span class="token operator">=</span> _AnimationDirection<span class="token punctuation">.</span>forward <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>kFlutterMemoryAllocationsEnabled<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">_maybeDispatchObjectCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        _ticker <span class="token operator">=</span> vsync<span class="token punctuation">.</span><span class="token function">createTicker</span><span class="token punctuation">(</span>_tick<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_internalSetValue</span><span class="token punctuation">(</span>value <span class="token operator">?</span><span class="token operator">?</span> lowerBound<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>bool canceled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token class-name">TickerFuture</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>double<span class="token operator">?</span> from<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token class-name">TickerFuture</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>double<span class="token operator">?</span> from<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token class-name">TickerFuture</span> <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>double<span class="token operator">?</span> from<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token class-name">TickerFuture</span> <span class="token function">repeat</span><span class="token punctuation">(</span>double<span class="token operator">?</span> min<span class="token punctuation">,</span> double<span class="token operator">?</span> max<span class="token punctuation">,</span> bool reverse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token operator">?</span> period<span class="token punctuation">,</span> int<span class="token operator">?</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <hr> <blockquote data-svelte-h="svelte-1t8uk66"><p>An <strong>AnimationController</strong> needs a <strong>TickerProvider</strong>, which is configured using the <strong>vsync</strong> argument on the constructor.</p> <p>The TickerProvider interface describes <strong>a factory for Ticker objects</strong>. A Ticker is an object that knows how to register itself with the <strong>SchedulerBinding</strong> and <strong>fires a callback every frame</strong>. The AnimationController class uses a Ticker to step through the animation that it controls.</p> <p>If an AnimationController is being created from a State, then the State can use the <strong>TickerProviderStateMixin</strong> and <strong>SingleTickerProviderStateMixin</strong> classes to implement the TickerProvider interface. The TickerProviderStateMixin class always works for this purpose; the SingleTickerProviderStateMixin is slightly more efficient in the case of the class only ever needing one Ticker.</p></blockquote> <ul data-svelte-h="svelte-1bwxdwc"><li><strong>AnimationController</strong>는 반드시 <strong>Ticker</strong>를 필요로함</li> <li>Ticker는 <strong>SchedulerBinding</strong>을 통해 <strong>매 프레임마다 주어진 callback을 실행</strong>시킬 수 있는 object</li> <li><strong>State</strong>안에서 AnimationController를 초기화하여 사용하는 경우 <strong>TickerProviderStateMixin</strong>을 함께 사용하여 Ticker를 넣어주도록 하자.</li></ul> <p data-svelte-h="svelte-w2ep54"><img src="/ticker.png" alt="ticker"></p> <h3 id="tickerproviderabstract" data-svelte-h="svelte-dpuuar">TickerProvider(abstract)</h3> <blockquote data-svelte-h="svelte-1jak0jd"><p>An interface implemented by classes that can vend Ticker objects.</p> <p>Tickers can be used by any object that wants to be notified whenever a frame triggers, but are most commonly used indirectly via an AnimationController.</p> <p>TickerProvider const constructor enables subclasses to provide const constructors so that they can be used in const expressions.</p></blockquote> <h3 id="ticker" data-svelte-h="svelte-87w0xg">Ticker</h3> <blockquote data-svelte-h="svelte-1appx2h"><p>Calls its callback once per animation frame.</p> <p>When created, a ticker is initially disabled. Call start to enable the ticker.</p> <p>A Ticker can be silenced by setting muted to true. While silenced, time still elapses, and start and stop can still be called, but no callbacks are called.</p> <p>By convention, the start and stop methods are used by the ticker’s consumer, and the muted property is controlled by the TickerProvider that create the ticker.</p> <p>Tickers are driven by the SchedulerBinding. See SchedulerBinding.schedulerFrameCallback.</p></blockquote> <h3 id="schedulerbindingmixin" data-svelte-h="svelte-1lfawoz">SchedulerBinding(mixin)</h3> <blockquote data-svelte-h="svelte-8eg73r"><p>Scheduler for running the following:</p> <ul><li>Transient callbacks, triggered by the system’s dart:ui.PlatformDispatcher.onBeginFrame callback, for synchronizing the application’s behavior to the system’s display. For example, Tickers and AnimationControllers trigger from these.</li> <li>Persistent callbacks, triggerd by the system’s dart:ui.PlatfromDispatcher.onDrawFrame callback, for updating the system’s display after transient callbacks have executed. For example, the rendering layer uses this to drive its rendering pipeline.</li> <li>Post-frame callbacks, which are run after persistent callbacks, just before returning from the dart:ui.PlatformDispatcher.onDrawFrame callbacks.</li> <li>Non-rendering tasks, to be run between frames. These are given a priority and are executed in priority order according to a schedulingStrategy.</li></ul></blockquote> <h3 id="schedulerbindingscheduleframecallbackmethod" data-svelte-h="svelte-jw0am3">SchedulerBinding.scheduleFrameCallback(method)</h3> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart">int <span class="token function">scheduleFrameCallback</span><span class="token punctuation">(</span>
    <span class="token class-name">FrameCallback</span> callback<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        bool rescheduling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-1xv70yj"><p>Schedules the given transient frame callback.</p> <p>Adds the given callback to the list of frame callbacks and ensures that a frame is scheduled.</p> <p>If this is called during the frame’s animation phase (when transient frame callbacks are still being invoked), a new frame will be scheduled, and callback will be called in the newly scheduled frame, not int the current frame.</p></blockquote> <h2 id="tween" data-svelte-h="svelte-z1tanw">Tween</h2> <blockquote data-svelte-h="svelte-1xt2aqj"><p>A <strong>linear interpolation</strong> between a beginning and ending value.</p> <p>Tween is useful if you want to interpolate across a range.</p> <p>To use a Tween object with an animation, call the Tween object’s <strong>animate</strong> method and pass it the Animation object that you want to modify.</p></blockquote> <hr> <blockquote data-svelte-h="svelte-7kegk0"><p>A Tween is a stateless object that takes only begin and end. The sol job of a Tween is to define a mapping from an input range to an output range. The input range is commonly 0.0 to 1.0, but that’s not a requirement.</p></blockquote> <ul data-svelte-h="svelte-1h9j2ez"><li><strong>Tween</strong>은 <strong>between</strong>의 준말이라고 생각하면 됨. <strong>begin</strong> to <strong>end</strong>.</li> <li>0.0 ~ 1.0 이 기본값으로 쓰이는데 이 값을 바꾸고 싶을 때 혹은 double이 아닌 다른 타입을 사용하고 싶을 때 유용</li> <li>animate 메서드를 이용해 animation controller를 연결.</li></ul> <p data-svelte-h="svelte-q85w6c"><strong>Example Code</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">CounterApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token class-name">CounterApp</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token metadata function">@override</span>
    <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterApp</span><span class="token punctuation">></span></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CounterAppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> _CounterAppState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterApp</span><span class="token punctuation">></span></span> <span class="token keyword">with</span> <span class="token class-name">SingleTickerProviderMixin</span><span class="token punctuation">&#123;</span>
    int count<span class="token punctuation">;</span>
    <span class="token class-name">Timer</span> _timer<span class="token punctuation">;</span>
    late <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> animation<span class="token punctuation">;</span>
    late <span class="token class-name">AnimationController</span> controller<span class="token punctuation">;</span>



    <span class="token keyword">void</span> <span class="token function">handleRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        _timer<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">cancle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cancel if the timer already exists.</span>
        controller<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reset the animation.</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        _timer <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">periodic</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                count <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> count <span class="token operator">-=</span> <span class="token number">1</span> <span class="token punctuation">:</span> timer<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// start the animation.</span>
    <span class="token punctuation">&#125;</span>

    <span class="token metadata function">@override</span>
    <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token metadata function">@override</span>
    <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// initialize the animation controller and animation to be controlled</span>
        controller <span class="token operator">=</span> <span class="token class-name">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animation <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span><span class="token operator">-</span>pi<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token metadata function">@override</span>
    <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// timer and controller are expensive resources so it should be removed when disposed.</span>
        _timer<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code><!-- HTML_TAG_END --></pre> <h2 id="animatedwidget" data-svelte-h="svelte-jjmkhy">AnimatedWidget</h2> <blockquote data-svelte-h="svelte-12rebn1"><p>A widget that rebuilds when the given Listenable changes value.</p> <p>AnimatedWidget is most commonly used with Animation objects, which are Listenable, but it can be used with any Listenable, including ChangeNotifier and ValueNotifier.</p> <p>AnimatedWidget is most useful for widgets that are otherwise stateless. To use AnimatedWidget, subclass it and implement the build function.</p></blockquote> <h1 id="개선1-using-prebuilt-animation-widget-circularprogressindicator" data-svelte-h="svelte-t9qozg">개선1. Using prebuilt animation widget (CircularProgressIndicator)</h1> <p data-svelte-h="svelte-tcwt7">정확히 이런 종류의 애니메이션을 위해 미리 만들어진 위젯이 있습니다.</p> <p data-svelte-h="svelte-1y6wn4b">찾을 수만 있다면 이처럼 미리 만들어진 위젯을 사용하는게 가장 좋다고 생각합니다.</p> <p data-svelte-h="svelte-1rowq2p">Flutter의 Widget of the week 시리즈에도 소개된 위젯이니 한번 봐보면 좋을 것 같습니다.</p> <p data-svelte-h="svelte-10ip4sn"><a href="https://youtu.be/O-rhXZLtpv0" rel="nofollow">Flutter Widget of the Week - CircularProgressIndicator &amp; LinearProgressIndicator</a></p> <h1 id="개선2-refactoring-with-animatedbuilder" data-svelte-h="svelte-lafanj">개선2. Refactoring with AnimatedBuilder</h1> <p data-svelte-h="svelte-glvr8k">AnimatedBuilder를 각 클래스가 담당하는 부분이 좀 더 명확하게 보이도록 분리시킬 수 있습니다.</p> <ol data-svelte-h="svelte-176d79d"><li>실제로 보여주고자 하는 도형에 대한 클래스 (이 경우 <strong>CustomCircle과 CustomPaint</strong>)</li> <li>해당 도형에 적용될 애니메이션 (<code>animation = Tween&lt;double&gt;(begin: 0, end: -2 * pi).animate(controller);</code>)</li> <li>해당 애니메이션의 렌더링에 대한 클래스 (<strong>RadialTransition</strong>)</li></ol> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:math'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>
<span class="token comment">// refactoring with AnimatedBuilder</span>
<span class="token comment">// The main advantage of using AnimatedBuilder is separating the responsibilities into different classes.</span>
<span class="token comment">// 1. Render the Actual object</span>
<span class="token comment">// 2. Define the animation object</span>
<span class="token comment">// 3. Render the transition</span>

<span class="token keyword">class</span> <span class="token class-name">CounterRefactor</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token class-name">CounterRefactor</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterRefactor</span><span class="token punctuation">></span></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CounterState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> _CounterState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterRefactor</span><span class="token punctuation">></span></span>
    <span class="token keyword">with</span> <span class="token class-name">SingleTickerProviderStateMixin</span> <span class="token punctuation">&#123;</span>
  late <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> animation<span class="token punctuation">;</span>
  late <span class="token class-name">AnimationController</span> controller<span class="token punctuation">;</span>
  late <span class="token class-name">Stopwatch</span> _stopwatch<span class="token punctuation">;</span>
  <span class="token class-name">Timer</span><span class="token operator">?</span> _timer<span class="token punctuation">;</span>
  <span class="token keyword">final</span> int maxTimeOut <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  int elapsedTimeInSeconds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  int _elapsed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    controller<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _stopwatch<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> elapsedTimeInSeconds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _stopwatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Periodic timer의 duration이 1초마다 바뀌는게 아닌 가능한 빨리(Duration.zero) 바뀌도록 설정해주고 있습니다.</span>
    <span class="token comment">// AnimatedWidget을 사용할 때와는 달리 RadialTransition의 child로 CustomPaint를 넣어주고</span>
    <span class="token comment">// 있기 때문에 기존처럼 1초마다 바뀌도록 하면 애니메이션이 뚝뚝 끊기듯이 재생됩니다.</span>
    <span class="token comment">// Stopwatch를 새롭게 추가해 elapsed time을 구해서 사용하도록 바꿔주었습니다.</span>
    _timer <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">periodic</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        _elapsed <span class="token operator">=</span> _stopwatch<span class="token punctuation">.</span>elapsedMilliseconds<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_elapsed <span class="token operator">~/</span> <span class="token number">1000</span> <span class="token operator">!=</span> elapsedTimeInSeconds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          elapsedTimeInSeconds <span class="token operator">=</span> _elapsed <span class="token operator">~/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxTimeOut <span class="token operator">-</span> elapsedTimeInSeconds <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          timer<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          _stopwatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _stopwatch <span class="token operator">=</span> <span class="token class-name">Stopwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller <span class="token operator">=</span>
        <span class="token class-name">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animation <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> pi<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
        width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token class-name">Stack</span><span class="token punctuation">(</span>
              alignment<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">.</span>center<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">Container</span><span class="token punctuation">(</span>
                  width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
                  height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>
                    shape<span class="token punctuation">:</span> <span class="token class-name">BoxShape</span><span class="token punctuation">.</span>circle<span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>onPrimary<span class="token punctuation">,</span>
                    border<span class="token punctuation">:</span> <span class="token class-name">Border</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">RadialTransition</span><span class="token punctuation">(</span>
                    animation<span class="token punctuation">:</span> animation<span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token class-name">CustomPaint</span><span class="token punctuation">(</span>
                      painter<span class="token punctuation">:</span> <span class="token class-name">CustomCircle</span><span class="token punctuation">(</span>
                          startAngle<span class="token punctuation">:</span> <span class="token operator">-</span>pi <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> sweepAngle<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      size<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Container</span><span class="token punctuation">(</span>
                  decoration<span class="token punctuation">:</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>onPrimary<span class="token punctuation">,</span>
                      shape<span class="token punctuation">:</span> <span class="token class-name">BoxShape</span><span class="token punctuation">.</span>circle<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token number">265</span><span class="token punctuation">,</span>
                  height<span class="token punctuation">:</span> <span class="token number">265</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>
                  <span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token expression">maxTimeOut <span class="token operator">-</span> elapsedTimeInSeconds</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
                  style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
                    fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                    fontSize<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">ElevatedButton</span><span class="token punctuation">(</span>onPressed<span class="token punctuation">:</span> restart<span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Restart"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">RadialTransition</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> <span class="token class-name">Animation</span> animation<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">Widget</span> child<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token class-name">RadialTransition</span><span class="token punctuation">(</span>
      <span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">AnimatedBuilder</span><span class="token punctuation">(</span>
      animation<span class="token punctuation">:</span> animation<span class="token punctuation">,</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
          decoration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>
            color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">,</span>
            shape<span class="token punctuation">:</span> <span class="token class-name">BoxShape</span><span class="token punctuation">.</span>circle<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> child<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> child<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomCircle</span> <span class="token keyword">extends</span> <span class="token class-name">CustomPainter</span> <span class="token punctuation">&#123;</span>
  double startAngle<span class="token punctuation">;</span>
  double sweepAngle<span class="token punctuation">;</span>

  <span class="token class-name">CustomCircle</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>required <span class="token keyword">this</span><span class="token punctuation">.</span>startAngle<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>sweepAngle<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span> <span class="token class-name">Size</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Paint</span> paint <span class="token operator">=</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paint<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">.</span>shade300<span class="token punctuation">;</span>
    paint<span class="token punctuation">.</span>strokeWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">Offset</span> canvasCenter <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">drawArc</span><span class="token punctuation">(</span>
        <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromCenter</span><span class="token punctuation">(</span>
            center<span class="token punctuation">:</span> canvasCenter<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
        startAngle<span class="token punctuation">,</span>
        sweepAngle<span class="token punctuation">,</span>
        <span class="token boolean">true</span><span class="token punctuation">,</span>
        paint<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  bool <span class="token function">shouldRepaint</span><span class="token punctuation">(</span>oldDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code><!-- HTML_TAG_END --></pre> <h1 id="개선3-using-ticker-instead-of-timer-counter" data-svelte-h="svelte-55q5vt">개선3. Using Ticker instead of Timer (Counter)</h1> <p data-svelte-h="svelte-1lctv0">Flutter의 대부분의 Animation 관련 위젯들은 내부적으로 Ticker를 사용하고 있습니다.</p> <p data-svelte-h="svelte-gcq54g">예를 들어 지금까지 사용하던 AnimationController도 사실은 Ticker를 이용해 스케줄링을 하고 있습니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">AnimationController</span> <span class="token keyword">extends</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span>
<span class="token keyword">with</span> <span class="token class-name">AnimationEagerListenerMixin</span><span class="token punctuation">,</span>
<span class="token class-name">AnimationLocalListenerMixin</span><span class="token punctuation">,</span>
<span class="token class-name">AnimationLocalStatusListenerMixin</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token class-name">Ticker</span><span class="token operator">?</span> _ticker<span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">void</span> <span class="token function">resync</span><span class="token punctuation">(</span><span class="token class-name">TickerProvider</span> vsync<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Ticker</span> oldTicker <span class="token operator">=</span> _ticker<span class="token punctuation">;</span>
        _ticker <span class="token operator">=</span> vsync<span class="token punctuation">.</span><span class="token function">createTicker</span><span class="token punctuation">(</span>_tick<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _ticker<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">absorbTicker</span><span class="token punctuation">(</span>oldTicker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1g0ujgz">Ticker를 사용하면 animation을 사용할 때와는 다른 custom painter가 필요합니다.</p> <p data-svelte-h="svelte-1id0l60">또한 Timer와는 다르게 elapsed time을 알 수 있어 stopwatch를 별도로 만들지 않아도 됩니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:math'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/scheduler.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CounterRefactor2</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token class-name">CounterRefactor2</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterRefactor2</span><span class="token punctuation">></span></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_CounterRefactor2State</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> _CounterRefactor2State <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CounterRefactor2</span><span class="token punctuation">></span></span>
    <span class="token keyword">with</span> <span class="token class-name">SingleTickerProviderStateMixin</span> <span class="token punctuation">&#123;</span>
  late <span class="token class-name">Ticker</span> _ticker<span class="token punctuation">;</span>
  <span class="token keyword">final</span> int maxTimeOut <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  int elapsedTimeInSeconds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token class-name">Duration</span> _elapsed <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
  double progress <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
  int <span class="token keyword">get</span> remainingTime <span class="token operator">=</span><span class="token operator">></span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> maxTimeOut <span class="token operator">-</span> _elapsed<span class="token punctuation">.</span>inSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _ticker <span class="token operator">=</span> <span class="token function">createTicker</span><span class="token punctuation">(</span><span class="token punctuation">(</span>elapsed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        _elapsed <span class="token operator">=</span> elapsed<span class="token punctuation">;</span>
        progress <span class="token operator">=</span> _elapsed<span class="token punctuation">.</span>inMilliseconds <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> maxTimeOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_elapsed<span class="token punctuation">.</span>inSeconds <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          _ticker<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _ticker<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">void</span> <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    _ticker<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _ticker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
        mainAxisAlignment<span class="token punctuation">:</span> <span class="token class-name">MainAxisAlignment</span><span class="token punctuation">.</span>center<span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token class-name">Stack</span><span class="token punctuation">(</span>
            alignment<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token class-name">CustomPaint</span><span class="token punctuation">(</span>
                painter<span class="token punctuation">:</span> <span class="token class-name">CustomCircle</span><span class="token punctuation">(</span>progress<span class="token punctuation">:</span> progress<span class="token punctuation">)</span><span class="token punctuation">,</span>
                size<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">Text</span><span class="token punctuation">(</span>
                <span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">remainingTime</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
                style<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
                  fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                  fontSize<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
                  color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token class-name">ElevatedButton</span><span class="token punctuation">(</span>
            onPressed<span class="token punctuation">:</span> restart<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Restart"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomCircle</span> <span class="token keyword">extends</span> <span class="token class-name">CustomPainter</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> double progress<span class="token punctuation">;</span>

  <span class="token class-name">CustomCircle</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>required <span class="token keyword">this</span><span class="token punctuation">.</span>progress<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span> <span class="token class-name">Size</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Offset</span> canvasCenter <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">Paint</span> background <span class="token operator">=</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    background<span class="token punctuation">.</span>strokeWidth <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    background<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">.</span>shade300<span class="token punctuation">;</span>
    background<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token class-name">PaintingStyle</span><span class="token punctuation">.</span>stroke<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>canvasCenter<span class="token punctuation">,</span> size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> background<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Paint</span> foreground <span class="token operator">=</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    foreground<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepPurple<span class="token punctuation">.</span>shade700<span class="token punctuation">;</span>
    foreground<span class="token punctuation">.</span>strokeWidth <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    foreground<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token class-name">PaintingStyle</span><span class="token punctuation">.</span>stroke<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">drawArc</span><span class="token punctuation">(</span>
        <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromCenter</span><span class="token punctuation">(</span>
            center<span class="token punctuation">:</span> canvasCenter<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>pi <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> pi <span class="token operator">*</span> progress<span class="token punctuation">,</span>
        <span class="token boolean">false</span><span class="token punctuation">,</span>
        foreground<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token metadata function">@override</span>
  bool <span class="token function">shouldRepaint</span><span class="token punctuation">(</span><span class="token keyword">covariant</span> <span class="token class-name">CustomCircle</span> oldDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> oldDelegate<span class="token punctuation">.</span>progress <span class="token operator">!=</span> progress<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <h1 id="sources" data-svelte-h="svelte-22jvrw">Sources</h1> <ul data-svelte-h="svelte-16u6rgo"><li><p><a href="https://api.flutter.dev/flutter/widgets/StatefulWidget-class.html" rel="nofollow">StatefulWidget</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/widgets/CustomPaint-class.html" rel="nofollow">CustomPaint</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/rendering/CustomPainter-class.html" rel="nofollow">CustomPainter</a></p></li> <li><p><a href="https://docs.flutter.dev/ui/animations" rel="nofollow">Animation in Flutter.dev</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/dart-async/Timer-class.html" rel="nofollow">Timer</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/scheduler/Ticker-class.html" rel="nofollow">Ticker</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/dart-core/Stopwatch-class.html" rel="nofollow">Stopwatch</a></p></li> <li><p><a href="https://api.flutter.dev/flutter/material/CircularProgressIndicator-class.html" rel="nofollow">CircularProgressIndicator</a></p></li></ul></div> </div></div> </div> 
			
			<script>
				{
					__sveltekit_k730i8 = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{publishedPosts:[{slug:"push_notifications",title:"How to send push notification",author:"jack",date:"2025. 05. 16",published:true,description:"Flutter 앱에서 사용자에게 알림을 보내는 방법에 대해 알아봅니다.",tags:["Firebase"]},{slug:"dart_async",title:"Dart asynchronous programming",author:"jack",description:"Dart에서 비동기를 구현하는 방식에 대해 알아보고 예시를 통해 학습 해봅니다.",published:true,date:"2025. 03. 27.",tags:["Dart"]},{slug:"understanding_hero_animation",title:"Understanding Flutter Hero animations process",description:"Flutter Hero animation에 대해 알아봅니다.",author:"jack",published:true,date:"2025. 02. 22.",tags:["Flutter"]},{slug:"dart_docs",title:"Effective Dart",description:"How to document my code.",author:"jack",published:true,date:"2025. 02. 17.",tags:["Dart"]},{slug:"union_types",title:"Union types in dart",description:"Union type에 대해 알아봅시다.",author:"jack",published:true,date:"2024. 12. 26.",tags:["Dart"]},{slug:"flutter_app_architecture2",title:"Flutter App Architecture(2) - Riverpod Architecture",author:"jack",description:"Riverpod 아키텍처에 대해 알아봅니다.",published:true,date:"2024. 12. 10.",tags:["Flutter"]},{slug:"flutter_app_architecture",title:"Flutter App Architecture(1) - MVVM",author:"jack",description:"MVVM(Model View ViewModel)아키텍처에 대해 알아봅니다.",published:true,date:"2024. 11. 23.",tags:["Flutter"]},{slug:"riverpod",title:"Flutter Package - Riverpod, State management tool",description:"Learn the core concept of provider and basic features of Riverpod.",author:"jack",published:true,date:"2024. 11. 08.",tags:["Flutter"]},{slug:"responsive_layout",title:"Responsive layout in Flutter(1)",description:"How to build responsive layout in flutter application. Learn about SafeArea, MediaQuery, LayoutBuilder and some best practices.",author:"jack",date:"2024. 10. 30.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge3",title:"Flutter UI Challenge(3)",description:"Learn some advanced usage of StatefulWidget, Widget builder, AnimatedWidget, and Transform.",author:"jack",date:"2024. 10. 16.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge2",title:"Flutter UI Challenge(2)",description:"Learn how to use StatefulWidgets and animate the changes of Widget. Widgets related to animations are Animation, AnimationController, Tween, AnimatedWidget and etc..",author:"jack",date:"2024. 10. 07.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge",title:"Flutter UI Challenge(1)",description:"Learn the basic layouts with Flutter challenges posted by Andrea. Some basic layout of flutter includes Row, Column, Stack, Expanded, Padding, etc...",author:"jack",date:"2024. 10. 05.",published:true,tags:["Flutter"]},{slug:"flutter_boilerplate_code2",title:"new Flutter project의 main.dart 코드 파헤쳐보기(2)",description:"IDE를 이용해 만든 flutter project의 초기 main.dart 코드들을 보면서 StatelessWidget, StatefulWidget, key에 대해 알아봅니다.",author:"jack",date:"2024.09. 29.",published:true,tags:["Flutter"]},{slug:"flutter_boilerplate_code1",title:"new Flutter project의 main.dart 코드 파헤쳐보기(1)",description:"IDE를 이용해 만든 flutter project의 초기 main.dart 코드들을 보면서 StatelessWidget, StatefulWidget, key에 대해 알아봅니다.",author:"jack",date:"2024.09. 27.",published:true,tags:["Flutter"]},{slug:"branches",title:"Branches in Dart",author:"jack",description:"Dart에서 Branch(분기)로 코드의 흐름을 제어하는 방법에 대해 알아봅니다.",published:true,date:"2024. 09. 24.",tags:["Dart"]},{slug:"records",title:"Record type in Dart",description:"Record type에 대해 알아봅니다.",author:"jack",date:"2024.09. 23.",published:true,tags:["Dart"]},{slug:"terminologies2",title:"헷갈리는 용어들 정리(2) - parameter & argument",description:"Dart의 Function에 대해 알아보며 parameter 와 argument 의 정확한 의미에 대해 알아봅니다.",author:"jack",published:true,date:"2024. 09. 21.",tags:["Dart"]},{slug:"terminologies1",title:"헷갈리는 용어들 정리(1) - statement & expression",description:"Dart의 switch 공식문서를 살펴보며 statement와 expression의 정의와 차이점에 대해 알아봅니다.",author:"jack",published:true,date:"2024. 09. 12.",tags:["Dart"]},{slug:"exercise2",title:"Practice Dart - exercises for beginners (2)",description:"Exercises to practice Dart.",author:"jack",published:true,date:"2024. 09. 09.",tags:["Dart"]},{slug:"exercise1",title:"Practice Dart - exercises for beginners (1)",description:"Exercises to practice Dart.",author:"jack",published:true,date:"2024. 09. 04.",tags:["Dart"]},{slug:"deploy-steps",title:"Deploy SvelteKit + MDsveX with github pages step by step.",description:"Step by step guide on how to setup SvelteKit + MDsveX and deploy it with github pages. Optional settings such as useful remark plugins, project structure setup etc. are also introduced.",author:"jack",published:true,date:"2024. 04. 22.",tags:["SvelteKit","Mdsvex","Github"]}],tags:new Set(["Firebase","Dart","Flutter","SvelteKit","Mdsvex","Github"])},"uses":{}},null];

					Promise.all([
						import("../_app/immutable/entry/start.BMziCj1o.js"),
						import("../_app/immutable/entry/app.DhY4kAqZ.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
	<script src="https://kit.fontawesome.com/56837ace2e.js" crossorigin="anonymous"></script>
</html>
