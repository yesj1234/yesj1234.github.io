<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="stylesheet" href="/styles/app.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.Bs5QCvu5.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.KdkzbpVi.css" rel="stylesheet">
		<link href="../_app/immutable/assets/ArticleMeta.VMQ7KKaF.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CXgIfTXn.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.CAsn5CxL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.B-IchvsE.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.B4Mf3DZh.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.BXAsoQ_g.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.Dv8jq0v4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/each.D6YF6ztN.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.BRDOs9Z0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CzR0xuCU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PageHead.lOwxy8xl.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/ArticleMeta.CnvR0XDo.js"><title>Union types in dart | SvelteKit + MDsveX Blog</title><!-- HEAD_svelte-1jfag13_START --><meta property="og:site_name" content="SvelteKit + MDsveX Blog"><meta property="og:title" content="Union types in dart"><meta property="og:description" content="Union type에 대해 알아봅시다."><!-- HEAD_svelte-1jfag13_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">  <div class="header-container svelte-8sye89"><div class="sidebarNavBtn svelte-8sye89"><button data-svelte-h="svelte-1w5a5mz"><i class="fa-solid fa-bars"></i></button></div>   <div class="svelte-149edha"><a href="/"><h1 class="small" data-svelte-h="svelte-9gkbac">Jack.dev.blog</h1></a> </div></div> <div class="sidebar-and-main svelte-8sye89"><div class="sidebar-container svelte-8sye89"><aside class="w-64" aria-label="Sidebar"><div class="overflow-y-auto py-4 px-3 bg-gray-50 rounded dark:bg-gray-800"><ul class="space-y-2 list-none"><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Dart"> <span class="ms-3">Dart</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Flutter"> <span class="ms-3">Flutter</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/SvelteKit"> <span class="ms-3">SvelteKit</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Mdsvex"> <span class="ms-3">Mdsvex</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Github"> <span class="ms-3">Github</span> </a></li>  <hr></ul> </div> </aside> </div> <div class="main svelte-8sye89"> <div class="metadata svelte-1nrt46a"><h2 class="heading svelte-1ujuesn large" id="union-types-in-dart"><a href="#union-types-in-dart">Union types in dart</a></h2> <p class="svelte-1uy9i9h"><div class="tags svelte-1uy9i9h"><span data-svelte-h="svelte-190wkx9">Tags:</span> <div class="tag-items-container svelte-1uy9i9h"><span class="tag svelte-1uy9i9h">Dart</span></div></div></p> <div class="metadata svelte-1uy9i9h"><span class="date svelte-1uy9i9h">2024. 12. 26. (Thu)</span> </div></div> <div class="component svelte-1nrt46a"><nav class="toc" data-svelte-h="svelte-yrleec"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#union-types">Union types</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#type-systems">Type systems</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#nominal-types">Nominal types</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#shaped-based-types">Shaped based types</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tagged-union-types">Tagged Union types</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#untagged-union-types">Untagged union types</a></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#dart-support-for-union-types">Dart support for Union types</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#futureorlttgt">FutureOr&lt;T&gt;</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#nullable-types">Nullable types</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#sealed-class-modifier---tagged-union-types">Sealed class modifier - Tagged union types</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#package---either">package - Either</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#package---extension-type-unions">package - Extension type unions</a></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#refactoring-example">Refactoring example</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#source">Source</a></li></ol></nav> <h1 id="union-types" data-svelte-h="svelte-1k2d1in">Union types</h1> <p data-svelte-h="svelte-1a6fha6">개인 프로젝트를 개발하는 와중에 Union type을 사용하고 싶은 경우가 있었습니다.</p> <p data-svelte-h="svelte-1lqpanw">상황은 다음과 같았습니다.</p> <ol data-svelte-h="svelte-11nzgo2"><li>포스트는 이미지 파일, 제목, 내용을 포함할 수 있습니다.</li> <li>이미지는 image picker 패키지를 통해 사진첩에서 <strong>XFile</strong> 타입으로 가져올 수 있으며 Image.File 위젯을 사용하여 보여줍니다.</li> <li>이미지를 포스트에 포함하여 저장할 경우에는 firestorage에 이미지 파일을 저장하고 download url을 받아 데이터베이스 해당 <strong>url을 String으로 저장</strong>합니다.</li> <li>이미지를 포함하는 기존의 포스트를 수정할 경우에는 원본 내용을 보여줘야 합니다. 이 경우 이미지는 download url을 string으로 받아서 Image.network 위젯을 통해 보여줍니다.</li> <li>만약 새로운 사진을 추가할 경우 이미지를 보여주는 위젯은 이제 <strong>download url(String)</strong> 과 <strong>XFile</strong> 두가지 타입을 동시에 처리할 수 있어야 합니다.</li></ol> <p data-svelte-h="svelte-1eccy64">따라서 String, XFile 두 가지 타입을 받기 위해 dynamic 타입으로 받아와서 타입이 String일 경우에는 Image.network위젯을, XFile일 경우에는 Image.file을 사용하도록 했습니다.</p> <p data-svelte-h="svelte-z9kbby">위와 같은 방식은 코드를 짜기 편리하다는 장점이 있지만 단점 또한 적지 않습니다.</p> <p data-svelte-h="svelte-qcfz50">단점은 다음과 같습니다.</p> <ul data-svelte-h="svelte-lpjb7q"><li>개발자가 직접 타입을 일일이 확인해서 해당 타입에 맞게 분기를 처리해주어야 하기 때문에 실수가 발생하기 쉽습니다(만약 타입이 여러개일 경우 미처 확인하지 못하고 지나가는 타입이 있는 경우 등).</li> <li>컴파일러가 타입을 인식하지 못하기 때문에 IDE의 자동완성기능과 같은 compile 언어의 장점을 제대로 활용할 수 없습니다.</li> <li>또한 String이나 XFile 타입이 아니라 다른 타입이 들어올 경우에는 runtime error가 발생할 수 있습니다.</li></ul> <p data-svelte-h="svelte-1ou4gwb">이런 단점들을 해결해보고자 Dart에서 union type을 다루는 방식에 대해 알아보고자 합니다.</p> <h1 id="type-systems" data-svelte-h="svelte-1d7r2ud">Type systems</h1> <p data-svelte-h="svelte-1jx27r6">Union type을 알아보기 전에 type에 대한 몇 가지 개념들에 대해 보고 가도록 합시다.</p> <p data-svelte-h="svelte-7fwm4k">개발 언어마다 type을 다루는 방식이 상이합니다.</p> <p data-svelte-h="svelte-10tjssy">예를 들어 typescript는 <strong>shape based typ</strong>e을 사용하고 java는 <strong>nominal type</strong>을 사용합니다.</p> <p data-svelte-h="svelte-1hrr6wk">shape based type과 nominal type은 <strong>타입간의 호환성</strong>(Type Compatibility), <strong>유연성</strong>(Flexibility), <strong>에러를 처리하는 방식</strong>에 차이가 있습니다.</p> <h2 id="nominal-types" data-svelte-h="svelte-1l9l5i3">Nominal types</h2> <p data-svelte-h="svelte-1vm5lwb"><strong>Nominal type</strong> 은…</p> <ul data-svelte-h="svelte-1dqha3z"><li>선언된 타입의 <strong>이름</strong> 혹은 <strong>identity</strong>에 기반합니다.</li> <li>타입의 <strong>이름 혹은 선언이 같은 경우</strong>에 두 가지 타입이 <strong>호환</strong>됩니다.</li> <li>상속(Inheritance)이나 서브 타이핑(subtyping) <strong>관계는 명시적으로 선언</strong>되어야 합니다.</li> <li>Java, C++, C#과 같은 언어가 nominal type을 사용합니다.</li></ul> <h2 id="shaped-based-types" data-svelte-h="svelte-1shtrv6">Shaped based types</h2> <p data-svelte-h="svelte-knek9z"><strong>Shaped based type</strong>은…</p> <ul data-svelte-h="svelte-cara4p"><li>타입의 이름이나 선언이 아닌 <strong>구조 / 모양(properties, method)</strong>으로 타입을 결정합니다.</li> <li>만약 이름이 서로 다른 두 타입이 <strong>같은 구조를 갖고 있다면 같은 타입</strong>으로 간주합니다.</li> <li>typescript, Go, OCaml 언어가 shaped based type을 사용합니다.</li> <li>python과 같은 동적인 언어에서는 duck typing(“If it looks like a duck and quacks like a duck, it’s a duck.“) 이라고도 합니다.</li></ul> <p data-svelte-h="svelte-8y5i44">예시 코드</p> <pre class="language-typescript"><!-- HTML_TAG_START --><code class="language-typescript"><span class="token comment">// Shaped based types</span>
<span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
	id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Order</span> <span class="token punctuation">&#123;</span>
	id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	total<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">printId</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>entity<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> user<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">'u123'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> order<span class="token operator">:</span> Order <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">'o456'</span><span class="token punctuation">,</span> total<span class="token operator">:</span> <span class="token number">99.99</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">printId</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Valid</span>
<span class="token function">printId</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Valid</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-y0vb4y">위처럼 typescript와 같은 Shape base type 시스템에서는 User 든 Order든 String 타입의 id를 갖고 있기 때문에 printId 함수를 실행시키는데 문제가 없습니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">UserId</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

  <span class="token class-name">UserId</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">OrderId</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

  <span class="token class-name">OrderId</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">String</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">UserId</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'User with ID: </span><span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token expression">id<span class="token punctuation">.</span>value</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">String</span> <span class="token function">getOrderById</span><span class="token punctuation">(</span><span class="token class-name">OrderId</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Order with ID: </span><span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token expression">id<span class="token punctuation">.</span>value</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> userId <span class="token operator">=</span> <span class="token class-name">UserId</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'u123'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> orderId <span class="token operator">=</span> <span class="token class-name">OrderId</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'o456'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Valid</span>
  <span class="token comment">// print(getUserById(orderId)); // Compile-time error</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1omvqt9">하지만 Dart와 같은 Nominal type 시스템에서는 UserId와 OrderId가 명확하게 다른 타입이기 때문에 컴파일 에러가 납니다.</p> <h2 id="tagged-union-types" data-svelte-h="svelte-1v1jkce">Tagged Union types</h2> <p data-svelte-h="svelte-135hqdn">Tagged union types 은 sum types, discriminated unions, 혹은 variant types 같은 이름으로도 불립니다.
이름에서 알 수 있듯이 tagged union type은 각각의 타입들이 다른 타입과는 구별되는 이름 혹은 식별자를 갖고 있기 때문에 더 안전하고 쉽게 사용할 수 있다는 장점이 있습니다.</p> <h2 id="untagged-union-types" data-svelte-h="svelte-8tbopm">Untagged union types</h2> <p data-svelte-h="svelte-p8i069">Untagged union type은 타입간의 구별을 위한 명시적인 이름이나 식별자가 없는 타입입니다.
따라서 하나의 객체가 여러가지의 타입을 가질 수 있게되지만 타입간의 상속관계를 정의할 수 없기 때문에 runtime에서 타입을 식별할 수 없습니다.
즉 개발자가 runtime에서 타입을 식별하기 위한 코드를 직접 작성해주어야 합니다.</p> <h1 id="dart-support-for-union-types" data-svelte-h="svelte-1pxyokk">Dart support for Union types</h1> <p data-svelte-h="svelte-1thv9s7">Dart는 typescript의 <code>|</code> 와 같이 Union type을 사용하기 위한 문법은 없긴하지만 Union type을 아예 배제하고 있진 않습니다.</p> <p data-svelte-h="svelte-s71uqd">Dart는 특정 상황에서 필요한 몇 가지 union type을 정의해놨습니다.</p> <h2 id="futureorlttgt" data-svelte-h="svelte-1bon3u5"><code>FutureOr&lt;T&gt;</code></h2> <blockquote data-svelte-h="svelte-1tkw2nn"><p>A type representing values that are either Future of type T or T.</p> <p>This class declaration is a public stand-in for an internal future - or - value generic type, which is not a class type. References to this class are resolved to the internal type.</p> <p>It is a compile-time error for any class to extend, mix in or implement FutureOr.</p></blockquote> <p data-svelte-h="svelte-1crbgn8"><code>Future&lt;T&gt;</code> 혹은 <code>&lt;T&gt;</code> 타입입니다.</p> <h2 id="nullable-types" data-svelte-h="svelte-qzedsj">Nullable types</h2> <p data-svelte-h="svelte-ubx92y"><code>T</code> 혹은 <code>null</code> 타입입니다.</p> <h2 id="sealed-class-modifier---tagged-union-types" data-svelte-h="svelte-1cza03q">Sealed class modifier - Tagged union types</h2> <p data-svelte-h="svelte-1rku0jw"><strong>sealed modifier</strong></p> <p data-svelte-h="svelte-zl62oe">sealed modifier는 이산적(enumerable)이고 다른 타입과는 구별되는(known) <strong>서브타입들의 집합</strong>을 만들기 위해 사용됩니다.</p> <p data-svelte-h="svelte-gnkpdx">sealed modifier로 정의된 클래스는 switch문과 함께 사용할 때 enum을 사용하는 것처럼 <strong>exhaustive checking</strong>을 보장해줍니다.</p> <p data-svelte-h="svelte-13sl2te">sealed class는 다음과 같은 성격을 갖습니다.</p> <ul data-svelte-h="svelte-lome"><li>내부적으로 <strong>abstract</strong>이기 때문에 직접 instance화 하여 사용할 수 없습니다.</li> <li>factory constructor를 가질 수 있습니다.</li> <li>subclass들이 사용할 constructor를 정의할 수 있습니다.</li> <li>library외부에서 sealed class를 상속(extend 혹은 implement) 할 수 없습니다.</li></ul> <p data-svelte-h="svelte-1ow0lzm">이처럼 sealed class는 library내부에서만 사용할 수 있기 때문에 compiler가 해당 클래스의 서브 클래스들을 모두 정확하게 파악할 수 있습니다.</p> <p data-svelte-h="svelte-n0r7zu">따라서 compile 타임에서 switch를 통한 exhaustive checking 기능을 사용할 수 있는 것입니다.</p> <h2 id="package---either" data-svelte-h="svelte-cg3ny2">package - Either</h2> <blockquote data-svelte-h="svelte-sajh8"><p>The library for error handling and railway oriented programming.
This library supports async “map” and async “then” hiding the boilerplate of working with asynchronous computations Future[Either].</p></blockquote> <p data-svelte-h="svelte-1o87aoy">Source: <a href="https://pub.dev/packages/either_dart" rel="nofollow">https://pub.dev/packages/either_dart</a></p> <h2 id="package---extension-type-unions" data-svelte-h="svelte-15hawgs">package - Extension type unions</h2> <blockquote data-svelte-h="svelte-1kr93jv"><p>Support for union types in Dart has been requested at least <a href="https://github.com/dart-lang/language/issues/1222" rel="nofollow">since 2012</a>. This repository provides a basic level of support for union types in Dart.</p></blockquote> <p data-svelte-h="svelte-1mtkgsy">Source: <a href="https://pub.dev/packages/extension_type_unions" rel="nofollow">https://pub.dev/packages/extension_type_unions</a></p> <h1 id="refactoring-example" data-svelte-h="svelte-dj44vf">Refactoring example</h1> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// BEFORE</span>
<span class="token comment">/// images are of type List&lt;dynamic></span>
<span class="token keyword">class</span> <span class="token class-name">PreviousFormState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PreviousForm</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">dynamic</span><span class="token punctuation">></span></span><span class="token operator">?</span> images<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>
			child<span class="token punctuation">:</span> <span class="token class-name">ImageWidgetLayout</span><span class="token punctuation">(</span>
				images<span class="token punctuation">:</span> images <span class="token operator">as</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">dynamic</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span class="token comment">/// AFTER</span>
<span class="token comment">/// To utilize the sealed class to represent union types,</span>
<span class="token comment">/// define ImageType and let UrlImage and XFileImage inherit ImageType</span>
<span class="token comment">/// so that the compiler can check if all the type is checked within switch syntax</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:image_picker/image_picker.dart'</span></span><span class="token punctuation">;</span>

sealed <span class="token keyword">class</span> <span class="token class-name">ImageType</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">UrlImage</span> <span class="token keyword">extends</span> <span class="token class-name">ImageType</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">UrlImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">XFileImage</span> <span class="token keyword">extends</span> <span class="token class-name">ImageType</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">XFileImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">XFile</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// each items of the images should be of type ImageType</span>
<span class="token keyword">class</span> <span class="token class-name">PreviousFormState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PreviousForm</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">dynamic</span><span class="token punctuation">></span></span><span class="token operator">?</span> images<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>
			child<span class="token punctuation">:</span> <span class="token class-name">ImageWidgetLayout</span><span class="token punctuation">(</span>
				images<span class="token punctuation">:</span> images<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
						  <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">is</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
						    <span class="token keyword">return</span> <span class="token class-name">UrlImage</span><span class="token punctuation">(</span>item <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
						    <span class="token keyword">return</span> <span class="token class-name">XFileImage</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
						  <span class="token punctuation">&#125;</span>
						<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// BEFORE</span>
<span class="token comment">///</span>
<span class="token keyword">class</span> <span class="token class-name">ImageWidgetLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token class-name">ImageWidgetLayout</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>images<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">dynamic</span><span class="token punctuation">></span></span> images<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token class-name">GridView</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
			gridDelegate<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
			itemCount<span class="token punctuation">:</span> images<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
			itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>runtimetype <span class="token operator">==</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
					<span class="token keyword">return</span> <span class="token class-name">URLImageTile</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">return</span> <span class="token class-name">XFileImageTile</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>

			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// AFTER</span>
<span class="token keyword">class</span> <span class="token class-name">ImageWidgetLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token class-name">ImageWidgetLayout</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token keyword">this</span><span class="token punctuation">.</span>images<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ImageType</span><span class="token punctuation">></span></span> images<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token class-name">GridView</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
			gridDelegate<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
			itemCount<span class="token punctuation">:</span> images<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
			itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">case</span> <span class="token class-name">UrlImage</span><span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token keyword">final</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
						<span class="token keyword">return</span> <span class="token class-name">UrlImageTile</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token class-name">XFileImage</span><span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token keyword">final</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
						<span class="token keyword">return</span> <span class="token class-name">XFileImageTile</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token class-name">Null</span><span class="token punctuation">:</span>
						<span class="token keyword">throw</span> <span class="token class-name">UnimplementedError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>

			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <h1 id="source" data-svelte-h="svelte-leqc2o">Source</h1> <p data-svelte-h="svelte-1yjmtxf"><a href="https://dcm.dev/blog/2024/12/10/demystifying-union-types-dart-tagged-untagged/" rel="nofollow">https://dcm.dev/blog/2024/12/10/demystifying-union-types-dart-tagged-untagged/</a></p> <p data-svelte-h="svelte-1mbrtkr"><a href="https://pub.dev/packages/either_dart" rel="nofollow">https://pub.dev/packages/either_dart</a></p> <p data-svelte-h="svelte-1u56kkr"><a href="https://pub.dev/packages/extension_type_unions" rel="nofollow">https://pub.dev/packages/extension_type_unions</a></p> </div></div> </div> 
			
			<script>
				{
					__sveltekit_fanivm = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{tags:new Set(["Dart","Flutter","SvelteKit","Mdsvex","Github"])},"uses":{}},null];

					Promise.all([
						import("../_app/immutable/entry/start.CXgIfTXn.js"),
						import("../_app/immutable/entry/app.B4Mf3DZh.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
	<script src="https://kit.fontawesome.com/56837ace2e.js" crossorigin="anonymous"></script>
</html>
