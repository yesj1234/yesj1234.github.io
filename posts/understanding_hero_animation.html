<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="stylesheet" href="/styles/app.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.Bs5QCvu5.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.KdkzbpVi.css" rel="stylesheet">
		<link href="../_app/immutable/assets/ArticleMeta.VMQ7KKaF.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CXgIfTXn.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.CAsn5CxL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.B-IchvsE.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.B4Mf3DZh.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.BXAsoQ_g.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.Dv8jq0v4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/each.D6YF6ztN.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.BRDOs9Z0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CzR0xuCU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PageHead.lOwxy8xl.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/ArticleMeta.CnvR0XDo.js"><title>Understanding Flutter Hero animations process | SvelteKit + MDsveX Blog</title><!-- HEAD_svelte-1jfag13_START --><meta property="og:site_name" content="SvelteKit + MDsveX Blog"><meta property="og:title" content="Understanding Flutter Hero animations process"><meta property="og:description" content="Flutter Hero animation에 대해 알아봅니다."><!-- HEAD_svelte-1jfag13_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">  <div class="header-container svelte-8sye89"><div class="sidebarNavBtn svelte-8sye89"><button data-svelte-h="svelte-1w5a5mz"><i class="fa-solid fa-bars"></i></button></div>   <div class="svelte-149edha"><a href="/"><h1 class="small" data-svelte-h="svelte-9gkbac">Jack.dev.blog</h1></a> </div></div> <div class="sidebar-and-main svelte-8sye89"><div class="sidebar-container svelte-8sye89"><aside class="w-64" aria-label="Sidebar"><div class="overflow-y-auto py-4 px-3 bg-gray-50 rounded dark:bg-gray-800"><ul class="space-y-2 list-none"><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Dart"> <span class="ms-3">Dart</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Flutter"> <span class="ms-3">Flutter</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/SvelteKit"> <span class="ms-3">SvelteKit</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Mdsvex"> <span class="ms-3">Mdsvex</span> </a></li>  <hr><li><a class="flex items-center p-2 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 m-1 text-xl font-semibold text-black" href="/tags/Github"> <span class="ms-3">Github</span> </a></li>  <hr></ul> </div> </aside> </div> <div class="main svelte-8sye89"> <div class="metadata svelte-1nrt46a"><h2 class="heading svelte-1ujuesn large" id="understanding-flutter-hero-animations-process"><a href="#understanding-flutter-hero-animations-process">Understanding Flutter Hero animations process</a></h2> <p class="svelte-1uy9i9h"><div class="tags svelte-1uy9i9h"><span data-svelte-h="svelte-190wkx9">Tags:</span> <div class="tag-items-container svelte-1uy9i9h"><span class="tag svelte-1uy9i9h">Dart</span><span class="tag svelte-1uy9i9h">Flutter</span></div></div></p> <div class="metadata svelte-1uy9i9h"><span class="date svelte-1uy9i9h">2025. 02. 22. (Sat)</span> </div></div> <div class="component svelte-1nrt46a"><nav class="toc" data-svelte-h="svelte-10fq1ug"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#hero를-이해하기-전에-알아두면-좋은-flutter-animation-library의-핵심-widget들">Hero를 이해하기 전에 알아두면 좋은 Flutter animation library의 핵심 widget들</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#hero-animation의-원리">Hero animation의 원리</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#구체적인-예시">구체적인 예시</a></li></ol></nav> <p data-svelte-h="svelte-u634hq">Flutter에서 hero animation은 다른 페이지로 이동 할 때 두 페이지 간의 공통되는 widget(대표적으로 이미지)이 화면에서 사라지지 않고 자연스럽게 시작 페이지에서 목표 페이지로 넘어가는 듯한 효과를 주는 애니메이션입니다.</p> <p data-svelte-h="svelte-9irwi5">일반적으로는 shared element transitions(animations)으로 알려져있습니다.</p> <h2 id="hero를-이해하기-전에-알아두면-좋은-flutter-animation-library의-핵심-widget들" data-svelte-h="svelte-ul7nxz">Hero를 이해하기 전에 알아두면 좋은 Flutter animation library의 핵심 widget들</h2> <ul data-svelte-h="svelte-1khr247"><li><p><a href="https://api.flutter.dev/flutter/animation/Tween-class.html" rel="nofollow"><strong>Tween</strong></a></p> <p>시작 값과 끝 값만을 파라미터로 받는 stateless widget. Tween은 단지 입력값을 원하는 출력값으로 변환해주는 역할입니다.</p></li></ul> <p data-svelte-h="svelte-1f2w87l"><strong>예시</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart">basicTween <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rTween <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><!-- HTML_TAG_END --></pre> <ul data-svelte-h="svelte-10t275m"><li><p><a href="https://api.flutter.dev/flutter/animation/AnimationController-class.html" rel="nofollow"><strong>AnimationController</strong></a></p> <p>vsync object를 필수적으로 파라미터로 넘겨주어야 합니다. 이를 위해 일반적으로는 SingleTickerProviderStateMixin 과 같은 클래스를 사용합니다.</p> <p>Tween이 매 프레임 만들어낼 때 마다 setState를 호출하여 화면을 갱신하는 식으로 애니메이션을 진행시킬 수 있습니다.</p></li></ul> <p data-svelte-h="svelte-1f2w87l"><strong>예시</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> _LogoAppState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogoApp</span><span class="token punctuation">></span></span> <span class="token keyword">with</span> <span class="token class-name">SingleTickerProviderStateMixin</span> <span class="token punctuation">&#123;</span>
	late <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> animation<span class="token punctuation">;</span>
	late <span class="token class-name">AnimationController</span> controller<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> sizeTween <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token metadata function">@override</span>
	<span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		controller <span class="token operator">=</span> <span class="token class-name">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		animation <span class="token operator">=</span> sizeTween<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token metadata function">@override</span>
	<span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
			child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
				width<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
				height<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
				child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">FlutterLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
</code><!-- HTML_TAG_END --></pre> <ul data-svelte-h="svelte-1yez62t"><li><p><a href="https://api.flutter.dev/flutter/widgets/AnimatedWidget-class.html" rel="nofollow"><strong>AnimatedWidget</strong></a></p> <p>Tween과 AnimationController를 이용하면 굉장히 explicit한 애니메이션 코드를 구현할 수 있습니다.</p> <p>하지만 애니메이션과 관련된 코드가 UI코드와 결합되기 때문에 코드의 복잡도가 올라가 가독성과 유지보수성이 떨어질 수 있습니다.</p> <p>이를 위해 UI와 애니메이션을 분리할 수 있게 도와주는 것이 AnimatedWidget입니다.</p> <p>UI는 그대로 그리고 외부에서 animation을 파라미터로 받아와서 사용하면 되는 식입니다.</p></li></ul> <p data-svelte-h="svelte-1f2w87l"><strong>예시</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">AnimatedLogo</span> <span class="token keyword">extends</span> <span class="token class-name">AnimatedWidget</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token class-name">AnimatedLogo</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> required <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> animation<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>listenable<span class="token punctuation">:</span> animation<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token metadata function">@override</span>
	<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">final</span> animation <span class="token operator">=</span> listenable <span class="token operator">as</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
			child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
			margin<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			height<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
			width<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
			child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">FlutterLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <ul data-svelte-h="svelte-hfpcvg"><li><p><a href="https://api.flutter.dev/flutter/widgets/AnimatedBuilder-class.html" rel="nofollow"><strong>AnimatedBuilder</strong></a></p> <p>AnimatedBuilder는 애니메이션이 필요한 부분을 다른 widget tree 중간에 넣어서 사용할 필요가 있을 때 사용하면 위젯입니다.</p> <p>AnimatedWidget이 animation과 UI를 분리했듯 AnimatedBuilder는 UI, animation, transition을 분리하여 사용할 수 있도록 도와줍니다.</p></li></ul> <h2 id="hero-animation의-원리" data-svelte-h="svelte-1kul2bo">Hero animation의 원리</h2> <p data-svelte-h="svelte-1gx6ss">Hero widget이 화면 전환 애니메이션을 구현하는 원리는 다음과 같습니다.</p> <ol data-svelte-h="svelte-ar77mw"><li>시작 화면과 도착 화면에서 사용될 <strong>hero widget을 정의</strong>합니다. 두 페이지간의 hero widget은 <strong>동일한 tag</strong>를 가져야 하며 tag가 다른 hero widget들과 <strong>중복 되어서는 안됩</strong>니다.</li> <li>시작 화면에서 도착 화면으로 가는 함수가 호출이 되는 경우(Navigator.of(context).push와 같은) 전환 애니메이션을 실행시키기 위해 도착지점에 대한 정보를 계산합니다(도착 지점 Hero의 사이즈, layout등).</li> <li>위에서 계산된 <strong>도착 지점의 hero</strong>를 Overlay의 시작 지점의 hero가 있던 동일한 위치와 사이즈에 배치합니다. Overlay에 배치된 hero는 전환 시에 항상 화면에 표시되도록 Z축값이 변경됩니다. (참고로 Overlay는 Navigator가 관리하는 widget입니다.)</li> <li>시작 지점의 hero를 화면에서 보이지 않도록 화면밖으로 이동됩니다.</li> <li>화면 전환 애니메이션이 시작됩니다. 전환 시 그려지는 애니메이션은 <code>Tween&lt;Rect&gt;</code> 를 이용해 그려지며 Hero의 createRectTween을 이용해 해당 애니메이션을 변경할 수 있습니다. 기본값은 MaterialRectArcTween입니다.</li> <li>애니메이션이 완료되면 도착 지점의 hero는 Overlay에서 도착 지점 페이지로 옮겨집니다.</li> <li>시작 지점이 화면 밖(offscreen) 에서 route stack에 복구됩니다.</li></ol> <h2 id="구체적인-예시" data-svelte-h="svelte-tgihm1">구체적인 예시</h2> <p data-svelte-h="svelte-2shwe5">저는 위와 같은 hero animation의 원리를 모르고 animation이 예상대로 동작하지 않는 문제를 가지고 하루 정도를 고민해본 경험이 있습니다.</p> <p data-svelte-h="svelte-1gasq6w">저의 상황은 다음과 같았습니다.</p> <p data-svelte-h="svelte-er9s6d">이미지의 개수에 따라 서로 다른 layout과 border radius를 갖게 하기 위해 이미지의 개수(1개 ~ 5개)에 따라서 다음과 같은 별도의 함수를 정의하여 사용했습니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// Simply return a single image tile returned from buildImageTile.</span>
<span class="token comment">/// width and height are just same with the parent.</span>
<span class="token comment">/// In this case, Source Hero's image and destination Hero's image has the same</span>
<span class="token comment">/// size, making super natural transition between two routes.</span>
<span class="token class-name">Widget</span> <span class="token function">_buildSingleImage</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token function">_buildImageTile</span><span class="token punctuation">(</span>
		index<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		width<span class="token punctuation">:</span> width<span class="token punctuation">,</span>
		height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
		total<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Widget</span> <span class="token function">_buildTwoImages</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token class-name">Row</span><span class="token punctuation">(</span>
		spacing<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
			<span class="token class-name">Expanded</span><span class="token punctuation">(</span>
				child<span class="token punctuation">:</span>
				<span class="token function">_buildImageTile</span><span class="token punctuation">(</span>
					index<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
					width<span class="token punctuation">:</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
					height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
					total<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
				<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token class-name">Expanded</span><span class="token punctuation">(</span>
				child<span class="token punctuation">:</span>
				<span class="token function">_buildImageTile</span><span class="token punctuation">(</span>
					index<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					width<span class="token punctuation">:</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
					height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
					total<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
				<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Widget</span> <span class="token function">_buildThreeImages</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
<span class="token class-name">Widget</span> <span class="token function">_buildFourImages</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
<span class="token class-name">Widget</span> <span class="token function">_buildFiveImages</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1lxu7x0">개별 이미지는 위에 정의된 별도의 함수로부터 width와 height를 전달받아 URLImageTile로 전달합니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// Builds an image tile based on the provided parameters.</span>
<span class="token class-name">Widget</span> <span class="token function">_buildImageTile</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>required int index<span class="token punctuation">,</span> required double width<span class="token punctuation">,</span> required double height<span class="token punctuation">,</span> required int total<span class="token punctuation">,</span> required context<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">final</span> image <span class="token operator">=</span> images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token class-name">BorderRadius</span><span class="token operator">?</span> borderRadius <span class="token operator">=</span>
	    <span class="token class-name">CustomImageWidgetLayout</span><span class="token punctuation">.</span><span class="token function">calculateBorderRadius</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token class-name">URLImageTile</span><span class="token punctuation">(</span>
	    url<span class="token punctuation">:</span> value<span class="token punctuation">,</span>
	    onDelete<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> onDelete<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
	    width<span class="token punctuation">:</span> width<span class="token punctuation">,</span>
	    height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
	    isEditMode<span class="token punctuation">:</span> isEditMode<span class="token punctuation">,</span>
	    borderRadius<span class="token punctuation">:</span> borderRadius<span class="token punctuation">,</span>
	  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-r0lkrn">URLImageTile은 다음과 같이 받아온 width, height를 SizedBox에 넘겨주어 크기를 고정시켜줍니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">URLImageTile</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token class-name">URLImageTile</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>onDelete<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>isEditMode<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>borderRadius<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> onDelete<span class="token punctuation">;</span>
	<span class="token keyword">final</span> bool isEditMode<span class="token punctuation">;</span>
	<span class="token keyword">final</span> double width<span class="token punctuation">;</span>
	<span class="token keyword">final</span> double height<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">BorderRadius</span><span class="token operator">?</span> borderRadius<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
		width<span class="token punctuation">:</span> width<span class="token punctuation">,</span>
		height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
		child<span class="token punctuation">:</span> <span class="token class-name">ClipRRect</span><span class="token punctuation">(</span>
		  borderRadius<span class="token punctuation">:</span> borderRadius <span class="token operator">?</span><span class="token operator">?</span>
		      <span class="token keyword">const</span> <span class="token class-name">BorderRadius</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
	        bottomLeft<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span>
	        bottomRight<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span>
	        topLeft<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	        topRight<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	      <span class="token punctuation">)</span><span class="token punctuation">,</span>
		  child<span class="token punctuation">:</span> <span class="token class-name">CachedNetworkImage</span><span class="token punctuation">(</span>
		    imageUrl<span class="token punctuation">:</span> url<span class="token punctuation">,</span>
		    width<span class="token punctuation">:</span> width<span class="token punctuation">,</span>
		    height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
		    fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
		    errorWidget<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> url<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">const</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span>
		      <span class="token class-name">Icons</span><span class="token punctuation">.</span>broken_image<span class="token punctuation">,</span>
		      size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
		  <span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1gokji8">이미지가 1개일 경우에는 문제 없이 정방향, 역방향 애니메이션 모두 자연스럽게 나타납니다.</p> <p data-svelte-h="svelte-sia8mx"><img src="/single_hero.gif" alt="single_hero.gif"></p> <p data-svelte-h="svelte-1m4rktb">문제는 이미지가 2 개 이상일 경우에는 다음과 같은 현상이 나타납니다.</p> <p data-svelte-h="svelte-54o1pt"><img src="/double_hero.gif" alt="double_hero.gif"></p> <p data-svelte-h="svelte-8o78hg">정방향 애니메이션은 자연스럽게 전환이 되지만 역방향 애니메이션은 크기가 갑자기 작아진 상태에서 시작하게 됩니다.</p> <p data-svelte-h="svelte-yz5n3f">Hero가 애니메이션을 그리는 원리의 3번째 단계를 상기해보겠습니다.</p> <ol start="3" data-svelte-h="svelte-1qlx6sh"><li>위에서 계산된 ”<strong>도착 지점의 hero를</strong>” Overlay의 시작 지점의 hero가 있던 위치에 시작지점의 hero와 같은 사이즈로 배치합니다. Overlay에 배치된 hero는 전환 시에 항상 화면에 표시되도록 Z축값이 변경됩니다.</li></ol> <p data-svelte-h="svelte-u58lje">Overlay에 배치되는 Hero는 <strong>“도착 지점의 Hero”</strong> 입니다.</p> <p data-svelte-h="svelte-59x5a1">이는 다음 코드와 같이 이미지가 1개 일 때 갖던 width의 절반 만큼만을 최대 사이즈로 갖는 Hero입니다.</p> <p data-svelte-h="svelte-1v3mg5b">따라서 화면에 그려지는 이미지의 사이즈가 순간적으로 작아지면서 애니메이션이 시작하게 되는 것입니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// Now 2 images have to share the width, so each image tile can have half of the width than the single image had.</span>
<span class="token comment">/// This leads</span>
<span class="token class-name">Widget</span> <span class="token function">_buildTwoImages</span><span class="token punctuation">(</span>double width<span class="token punctuation">,</span> double height<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token class-name">Row</span><span class="token punctuation">(</span>
		spacing<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
			<span class="token class-name">Expanded</span><span class="token punctuation">(</span>
				child<span class="token punctuation">:</span>
				<span class="token function">_buildImageTile</span><span class="token punctuation">(</span>
					index<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
					width<span class="token punctuation">:</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
					height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
					total<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
				<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token class-name">Expanded</span><span class="token punctuation">(</span>
				child<span class="token punctuation">:</span>
				<span class="token function">_buildImageTile</span><span class="token punctuation">(</span>
					index<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					width<span class="token punctuation">:</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
					height<span class="token punctuation">:</span> height<span class="token punctuation">,</span>
					total<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>
				<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-es4axp">이를 해결하기 위해서는 양 쪽의 Hero가 가질 수 있는 width, height의 값을 동일하게 맞춰줄 필요가 있습니다.</p> <p data-svelte-h="svelte-76s6nl">저는 ConstrainedBox를 이용해 이를 구현했습니다.</p> <p data-svelte-h="svelte-1qzh68e"><strong>Fixed Code:</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">/// Displays network images with caching support via CachedNetworkImage. Shows delete button in edit mode.</span>
<span class="token keyword">class</span> <span class="token class-name">URLImageTile</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token class-name">URLImageTile</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>onDelete<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>isEditMode<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>maxWidth<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>maxHeight<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>minWidth<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>minHeight<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>borderRadius<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> onDelete<span class="token punctuation">;</span>
  <span class="token keyword">final</span> bool isEditMode<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double maxWidth<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double maxHeight<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double minWidth<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double minHeight<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">BorderRadius</span><span class="token operator">?</span> borderRadius<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span>
      <span class="token class-name">ConstrainedBox</span><span class="token punctuation">(</span>
        constraints<span class="token punctuation">:</span> <span class="token class-name">BoxConstraints</span><span class="token punctuation">(</span>
          minHeight<span class="token punctuation">:</span> minHeight<span class="token punctuation">,</span>
          minWidth<span class="token punctuation">:</span> minWidth<span class="token punctuation">,</span>
          maxWidth<span class="token punctuation">:</span> maxWidth<span class="token punctuation">,</span>
          maxHeight<span class="token punctuation">:</span> maxHeight<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">ClipRRect</span><span class="token punctuation">(</span>
          borderRadius<span class="token punctuation">:</span> borderRadius <span class="token operator">?</span><span class="token operator">?</span>
              <span class="token keyword">const</span> <span class="token class-name">BorderRadius</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
                bottomLeft<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span>
                bottomRight<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span>
                topLeft<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                topRight<span class="token punctuation">:</span> <span class="token class-name">Radius</span><span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">CachedNetworkImage</span><span class="token punctuation">(</span>
            imageUrl<span class="token punctuation">:</span> url<span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> maxWidth<span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> maxHeight<span class="token punctuation">,</span>
            fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
            errorWidget<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> url<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">const</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span>
              <span class="token class-name">Icons</span><span class="token punctuation">.</span>broken_image<span class="token punctuation">,</span>
              size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1x8m9fu">긴 글 읽어주셔서 감사합니다.</p> <p data-svelte-h="svelte-1of2tu2">Sources</p> <ul data-svelte-h="svelte-1ycx0du"><li><a href="https://docs.flutter.dev/ui/animations/hero-animations" rel="nofollow">https://docs.flutter.dev/ui/animations/hero-animations</a></li> <li><a href="https://api.flutter.dev/flutter/widgets/Navigator-class.html" rel="nofollow">https://api.flutter.dev/flutter/widgets/Navigator-class.html</a></li> <li><a href="https://api.flutter.dev/flutter/widgets/Overlay-class.html" rel="nofollow">https://api.flutter.dev/flutter/widgets/Overlay-class.html</a></li> <li><a href="https://api.flutter.dev/flutter/animation/Tween-class.html" rel="nofollow">https://api.flutter.dev/flutter/animation/Tween-class.html</a></li> <li><a href="https://api.flutter.dev/flutter/animation/AnimationController-class.html" rel="nofollow">https://api.flutter.dev/flutter/animation/AnimationController-class.html</a></li></ul> </div></div> </div> 
			
			<script>
				{
					__sveltekit_fanivm = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{tags:new Set(["Dart","Flutter","SvelteKit","Mdsvex","Github"])},"uses":{}},null];

					Promise.all([
						import("../_app/immutable/entry/start.CXgIfTXn.js"),
						import("../_app/immutable/entry/app.B4Mf3DZh.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
	<script src="https://kit.fontawesome.com/56837ace2e.js" crossorigin="anonymous"></script>
</html>
