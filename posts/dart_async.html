<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="stylesheet" href="/styles/app.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.BwancY7n.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.noKbvbNA.css" rel="stylesheet">
		<link href="../_app/immutable/assets/ArticleMeta.VMQ7KKaF.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.totQVT8G.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.BjXhztgk.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.BR55WShb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CXVSoEhx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.ab6CEODS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.DZHVcTXD.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.BeLlwaxg.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/each.D6YF6ztN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/header.vhBZ3ANe.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.u1DtSKSV.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.CzR0xuCU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PageHead.DxCapelc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/ArticleMeta.B7E3AiTX.js"><title>Dart asynchronous programming | yesj1234.github.io</title><!-- HEAD_svelte-1jfag13_START --><meta property="og:site_name" content="yesj1234.github.io"><meta property="og:title" content="Dart asynchronous programming"><meta property="og:description" content="Dart에서 비동기를 구현하는 방식에 대해 알아보고 예시를 통해 학습 해봅니다."><!-- HEAD_svelte-1jfag13_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">  <div class="sidebar-and-main svelte-d6nbxv"><div class="sidebar2 svelte-d6nbxv"><div class="container svelte-76a3v9"><div class="sidebar svelte-76a3v9"><div class="menu svelte-76a3v9"><button type="button" class="menu-item svelte-76a3v9" data-svelte-h="svelte-4rz7h9"><i class="fa-regular fa-copy"></i></button> <div class="menu-item svelte-76a3v9" data-svelte-h="svelte-608ww5"><i class="fa-solid fa-magnifying-glass"></i></div> <button class="menu-item svelte-76a3v9" data-svelte-h="svelte-1fo943y"><a href="/"><i class="fa-solid fa-house"></i></a></button></div></div> <div class="sidebar-folders svelte-76a3v9 closed" style="width: 0px; transition: width 0.3s ease;"><button class="root-folder svelte-76a3v9"><div class="root-folder-title svelte-76a3v9"><span class="arrow-icon svelte-76a3v9" data-svelte-h="svelte-w8ixat"><i class="fa-solid fa-chevron-right"></i></span> <span class="root-folder svelte-76a3v9" data-svelte-h="svelte-1ag9bxk">YESJ1234.GITHUB.IO</span></div></button> </div> </div></div> <div class="main svelte-d6nbxv"><div class="header-container svelte-d6nbxv"><div><div class="container svelte-18ebzw"></div> </div></div> <div class="container svelte-rlxdxu"><div class="metadata svelte-rlxdxu"> <h2 class="heading svelte-1ujuesn large" id="dart-asynchronous-programming"><a href="#dart-asynchronous-programming">Dart asynchronous programming</a></h2> <p class="svelte-1uy9i9h"><div class="tags svelte-1uy9i9h"><span data-svelte-h="svelte-190wkx9">Tags:</span> <div class="tag-items-container svelte-1uy9i9h"><span class="tag svelte-1uy9i9h">Dart</span></div></div></p> <div class="metadata svelte-1uy9i9h"><span class="date svelte-1uy9i9h">2025. 03. 27. (Thu)</span> </div></div> <div class="component svelte-rlxdxu"><nav class="toc" data-svelte-h="svelte-c5fon5"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#basic-concepts">Basic concepts</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#asynchronous-programming-in-dart">Asynchronous programming in Dart</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#future">Future</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#stream">Stream</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#isolates">Isolates</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#event-loops">Event loops</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#event-queues">Event queues</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#이벤트-루프의-실행-순서">이벤트 루프의 실행 순서</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#example">Example</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#이전-코드의-실행-순서">이전 코드의 실행 순서</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#개선된-코드의-실행-순서">개선된 코드의 실행 순서</a></li></ol></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#source">Source</a></li></ol></nav> <h1 id="basic-concepts" data-svelte-h="svelte-17lvad3">Basic concepts</h1> <h2 id="asynchronous-programming-in-dart" data-svelte-h="svelte-11zff2l">Asynchronous programming in Dart</h2> <h3 id="future" data-svelte-h="svelte-18eyawo">Future</h3> <p data-svelte-h="svelte-15xjo9c"><strong>Future</strong> 객체는 아직 결과값이 정해지지 않은 미래의 계산 작업(<strong>computation</strong>)을 의미합니다. 어떤 계산이 완료되면 Future는 그 결과값을 반환합니다. Future는 주로 별도의 스레드나 격리된 환경(<strong>Isolate</strong>)에서 실행되는 비동기 작업을 처리할 때 사용됩니다. 예를 들어, <code>dart:io</code>의 파일 입출력 작업이나 <code>dart:html</code>의 HTTP 요청 같은 경우가 있습니다.</p> <p data-svelte-h="svelte-12zpbf">Dart의 많은 메서드들은 특정 작업을 수행할 때 Future를 반환합니다. 예를 들어, <code>HttpServer.bind()</code> 메서드는 서버를 특정 IP와 포트에 연결하는데, 이 과정이 완료되면 Future를 통해 결과를 반환합니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"> <span class="token class-name">HttpServer</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'127.0.0.1'</span></span><span class="token punctuation">,</span> <span class="token number">4444</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token expression">server<span class="token punctuation">.</span>isBroadcast</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-104qim0">위 코드에서 <code>bind()</code> 메서드는 서버를 설정하는 작업을 실행하고, 작업이 성공하면 <code>then()</code> 안의 코드가 실행됩니다. 여기서 <code>server.isBroadcast</code> 값을 출력하는 것이죠. 만약 오류가 발생하면 <code>catchError()</code>에 등록된 코드가 실행되어 오류 내용을 출력합니다.</p> <p data-svelte-h="svelte-1vljcxb">Future는 이렇게 특정 <strong>작업이 완료된 후 실행될 코드를 미리 등록</strong>해두고, 결과를 기다렸다가 <strong>적절한 시점에 실행</strong>할 수 있도록 도와주는 개념입니다.</p> <h3 id="stream" data-svelte-h="svelte-1n11wr0">Stream</h3> <p data-svelte-h="svelte-1bdx73w"><strong>Stream은</strong> 비동기적으로 <strong>연속된 데이터를 제공</strong>하는 개념입니다. 데이터가 순차적으로 전달되는 예로는 마우스 클릭 같은 개별 이벤트나, 파일의 내용을 여러 개의 바이트 리스트로 나누어 읽는 경우가 있습니다.</p> <p data-svelte-h="svelte-eaucim">아래 예제는 파일을 읽기 위해 Stream을 사용합니다.<br> <a href="https://api.dart.dev/stable/latest/dart-async/Stream/listen.html" rel="nofollow">Stream.listen</a> 메서드를 사용하면 새로운 데이터가 들어올 때마다 실행할 콜백 함수를 등록할 수 있습니다. 또한, 오류가 발생했을 때나 스트림이 종료되었을 때 실행할 함수도 설정할 수 있습니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span>int<span class="token punctuation">></span><span class="token punctuation">></span></span> stream <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'quotes.txt'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span>decoder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-mr9ygy">이 스트림은 여러 개의 바이트 리스트를 순차적으로 내보냅니다. 프로그램은 이 바이트 리스트들을 적절한 방식으로 처리해야 합니다. 위 코드에서는 <code>dart:convert</code> 라이브러리의 UTF-8 디코더를 사용해 바이트 스트림을 문자열 스트림으로 변환하고 출력합니다.</p> <p data-svelte-h="svelte-gxr68n">스트림은 웹 애플리케이션에서 사용자의 입력 이벤트를 처리할 때도 자주 사용됩니다. 예를 들어, 아래 코드는 특정 버튼이 클릭될 때마다 이벤트를 감지하고 실행됩니다.</p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'#myButton'</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Click.'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-15igqi7">이렇게 스트림을 활용하면 이벤트가 발생할 때마다 즉시 반응할 수 있으며, 데이터가 도착하는 즉시 처리하는 비동기 방식의 프로그래밍이 가능합니다.</p> <h3 id="isolates" data-svelte-h="svelte-1l08h3w">Isolates</h3> <p data-svelte-h="svelte-1bqcc2a"><strong>Isolate</strong>는 모든 Dart 코드가 실행되는 단위입니다. 이것은 기계 안에서 <strong>독립적인</strong> 작은 공간처럼 작동하며, <strong>자체적인 메모리 영역</strong>을 가지고 있고, 하나의 스레드가 이벤트 루프를 실행하는 구조입니다.</p> <p data-svelte-h="svelte-1yf46ot">C++ 같은 많은 다른 언어에서는 여러 개의 스레드가 하나의 메모리를 공유하며 원하는 코드를 실행할 수 있습니다. 하지만 Dart에서는 각 스레드가 자신만의 <code>Isolate(아이솔레이트)</code>에서 실행되며, 독립적인 메모리를 가지며, 이벤트를 처리하는 방식으로 동작합니다.</p> <p data-svelte-h="svelte-1iktifq">대부분의 Dart 애플리케이션은 하나의 아이솔레이트에서 모든 코드를 실행하지만, 필요하다면 여러 개를 만들 수도 있습니다. 예를 들어, 매우 큰 연산을 수행해야 하는 경우 메인 아이솔레이트에서 실행하면 프레임 드롭이 발생할 수 있습니다. 이런 경우, Dart의 <a href="https://api.dartlang.org/stable/dart-isolate/Isolate/spawn.html" rel="nofollow"><code>Isolate.spawn()</code></a> 또는 Flutter의 <a href="https://flutter.dev/docs/cookbook/networking/background-parsing#4-move-this-work-to-a-separate-isolate" rel="nofollow"><code>compute()</code> 함수</a>를 사용하면 됩니다. 이 함수들은 새로운 아이솔레이트를 생성하여 복잡한 연산을 처리하고, 메인 아이솔레이트는 위젯 트리를 리빌드하고 렌더링하는 등의 작업을 계속할 수 있도록 해줍니다.</p> <p data-svelte-h="svelte-1wyojlr">새로운 아이솔레이트는 자체적인 이벤트 루프와 메모리를 가지며, 이를 생성한 원래 아이솔레이트조차도 해당 메모리에 접근할 수 없습니다. 이러한 독립적인 특성 때문에 <code>Isolate(아이솔레이트)</code>라는 이름이 붙었습니다. 즉, 각 아이솔레이트는 서로 <strong>격리(isolated)</strong> 되어 있습니다.</p> <p data-svelte-h="svelte-lai47h">실제로 아이솔레이트들이 협력하는 유일한 방법은 <strong>메시지를 주고받는 것</strong>입니다. 한 아이솔레이트가 다른 아이솔레이트로 메시지를 보내면, 받은 아이솔레이트는 자신의 <strong>이벤트 루프</strong>를 이용해 해당 메시지를 처리합니다.</p> <p data-svelte-h="svelte-1ydgf1y">Java나 C++ 같은 언어에서 멀티스레드 프로그래밍을 해본 경험이 있다면, Dart의 아이솔레이트 개념이 다소 제한적으로 보일 수도 있습니다. 하지만 이런 구조는 Dart 개발자들에게 몇 가지 중요한 이점을 제공합니다.</p> <p data-svelte-h="svelte-s5s9nn">예를 들어, 아이솔레이트 내부의 메모리 할당과 가비지 컬렉션(GC)은 <strong>락(lock)을 사용하지 않고도 안전하게 처리됩니다.</strong> <strong>하나의 아이솔레이트</strong>에는 <strong>단 하나의 스레드</strong>만 존재하므로, 그 스레드가 실행되지 않는 동안에는 메모리가 변경될 가능성이 없습니다. 이러한 구조는 Flutter 애플리케이션이 빠르게 위젯을 생성하고 파괴하는 작업을 수행할 때 매우 유용합니다.</p> <h3 id="event-loops" data-svelte-h="svelte-11ms9od">Event loops</h3> <img src="/queue.jpg" width="70%" alt="queue.jpg"> <p data-svelte-h="svelte-1mxxubw">앱이 시작하고, 종료되기까지 여러 이벤트가 발생합니다. 디스크에서 데이터를 읽거나, 사용자가 화면을 터치하는 등 다양한 이벤트가 있습니다.</p> <p data-svelte-h="svelte-2vbiz7">앱은 이러한 이벤트가 언제, 어떤 순서로 발생할지 예측할 수 없으며, <strong>단 하나의 스레드</strong>로 모든 이벤트를 처리해야 합니다. 하지만 이 <strong>스레드</strong>는 절대 <strong>블로킹되지 않아야</strong> 하죠. 그래서 앱은 <strong>이벤트 루프(event loop)</strong> 를 실행합니다.<br>
이벤트 루프는 <strong>이벤트 큐</strong>(<strong>event queue</strong>)에서 가장 오래된 이벤트를 가져와 처리하고, 다음 이벤트를 가져와 처리하는 방식으로 계속 반복됩니다. 큐가 비워질 때까지 이 과정이 이어집니다.</p> <p data-svelte-h="svelte-1v9glm7">앱이 실행되는 동안, 사용자는 화면을 터치하고, 파일이 다운로드되며, 타이머가 울릴 수도 있습니다. 이벤트 루프는 이러한 이벤트들을 <strong>한 번에 하나씩</strong> 처리하면서 계속 돌아갑니다.</p> <p data-svelte-h="svelte-1mzpx05">이벤트가 없는 순간에는 스레드가 대기 상태가 됩니다. 이때는 가비지 컬렉션(GC)이 실행될 수도 있고, 그냥 멈춰 있을 수도 있습니다.</p> <p data-svelte-h="svelte-mohmmg">Dart의 <strong>비동기 프로그래밍을 위한 고수준 API와 언어 기능</strong>— <code>Future</code>, <code>Stream</code>, <code>async</code> 및 <code>await</code>—은 모두 이 단순한 이벤트 루프를 기반으로 작동합니다.</p> <h3 id="event-queues" data-svelte-h="svelte-1l4092v">Event queues</h3> <p data-svelte-h="svelte-h4lrv9">Dart 애플리케이션은 단 하나의 <strong>이벤트 루프(event loop)</strong> 를 가지고 있으며, 여기에는 <strong>두 개의 큐(queue)</strong> 가 존재합니다.<br>
바로 <strong>이벤트 큐(event queue)</strong> 와 <strong>마이크로태스크 큐(microtask queue)</strong> 입니다.</p> <p data-svelte-h="svelte-1r73dz6"><strong>이벤트 큐 (Event Queue)</strong> <strong>외부에서 발생하는 이벤트</strong> 들이 저장됩니다.<br>
예를 들어, I/O 작업, 마우스 이벤트, 화면 렌더링 이벤트, 타이머, Dart 아이솔레이트 간의 메시지 등이 이벤트 큐에 들어갑니다.</p> <p data-svelte-h="svelte-imq1v1"><strong>마이크로태스크 큐 (Microtask Queue)</strong> 는 특정 작업을 <strong>나중에 실행하지만, 이벤트 루프의 제어권을 반환하기 전에 반드시 실행해야 할 경우</strong> 필요합니다.<br>
예를 들어, <strong>Observable 객체</strong>(변경 사항을 감지하는 객체)가 변경될 때, 여러 개의 변경을 묶어서 비동기적으로 보고하는 경우가 있습니다.</p> <p data-svelte-h="svelte-1ahcg2i">이벤트 큐에는 <strong>Dart 내부에서 발생한 이벤트뿐만 아니라, 시스템 외부에서 발생한 이벤트도 포함됩니다.</strong><br>
반면, 현재 마이크로태스크 큐에는 <strong>Dart 코드 내부에서 생성된 작업만</strong> 들어갑니다.</p> <h3 id="이벤트-루프의-실행-순서" data-svelte-h="svelte-6myvnk"><strong>이벤트 루프의 실행 순서</strong></h3> <p data-svelte-h="svelte-1xi0set">아래 그림과 같이, <code>main()</code> 함수가 종료되면 <strong>이벤트 루프가 실행을 시작합니다.</strong></p> <ol data-svelte-h="svelte-ifxyv"><li>먼저, <strong>모든 마이크로태스크</strong> 를 <strong>FIFO(First In, First Out) 순서로 실행</strong>합니다.</li> <li>그 후, <strong>이벤트 큐에서 첫 번째 이벤트를 가져와 실행</strong>합니다.</li> <li>다시 <strong>모든 마이크로태스크를 실행</strong>한 후, <strong>이벤트 큐에서 다음 이벤트를 처리</strong>합니다.</li> <li>이 과정을 반복합니다.</li></ol> <p data-svelte-h="svelte-ip4xq">이벤트 큐와 마이크로태스크 큐가 <strong>모두 비어 있고, 더 이상 실행할 이벤트가 없을 때</strong>,<br>
앱의 <strong>임베더(embedder)</strong> (예: 브라우저나 테스트 프레임워크)는 앱을 종료할 수 있습니다.</p> <img src="/process.jpg" width="70%" alt="process.jpg"> <h2 id="example" data-svelte-h="svelte-1j28j6e">Example</h2> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">// Asynchronous network request that will eventually return Future with</span>
<span class="token comment">// downloadURL as String on success, and Error on failure.</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">_uploadBytes</span><span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span>required <span class="token class-name">Uint8List</span> bytes<span class="token punctuation">,</span>
    <span class="token class-name">String</span><span class="token operator">?</span> path<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token class-name">DateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>millisecondsSinceEpoch<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Reference</span> storageRef <span class="token operator">=</span>
      <span class="token class-name">FirebaseStorage</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token expression">path <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">''</span></span></span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> compressedBytes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">FlutterImageCompress</span><span class="token punctuation">.</span><span class="token function">compressWithList</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">UploadTask</span> uploadTask <span class="token operator">=</span> storageRef<span class="token punctuation">.</span><span class="token function">putData</span><span class="token punctuation">(</span>compressedBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">TaskSnapshot</span> snapshot <span class="token operator">=</span> <span class="token keyword">await</span> uploadTask<span class="token punctuation">;</span>

  <span class="token class-name">String</span> downloadURL <span class="token operator">=</span> <span class="token keyword">await</span> snapshot<span class="token punctuation">.</span>ref<span class="token punctuation">.</span><span class="token function">getDownloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> downloadURL<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-n6001m"><strong>Before:</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> imageURLs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Process the asynchronous task sequentially, which does not have any</span>
<span class="token comment">// dependencies with each other, redundantly consuming the time spent on</span>
<span class="token comment">// the whole process to complete.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> image <span class="token keyword">in</span> images<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">final</span> bytes <span class="token operator">=</span> <span class="token keyword">await</span> image<span class="token punctuation">.</span><span class="token function">readAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// meaninglessly waiting for the upload process to finish, blocking the next</span>
  <span class="token comment">// image from uploading.</span>
  <span class="token keyword">final</span> downloadURL <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_uploadBytes</span><span class="token punctuation">(</span>
    bytes<span class="token punctuation">:</span> bytes<span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'images'</span></span><span class="token punctuation">,</span>
    progressCallback<span class="token punctuation">:</span> progressCallback<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  imageURLs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>downloadURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
newJournal <span class="token operator">=</span> newJournal<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>images<span class="token punctuation">:</span> imageURLs<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-u7163h"><strong>After:</strong></p> <pre class="language-dart"><!-- HTML_TAG_START --><code class="language-dart"><span class="token comment">// imageUploadTasks is a list of Future&lt;String?>, which means the callback inside the .map() does not execute immediately.</span>
<span class="token keyword">final</span> imageUploadTasks <span class="token operator">=</span> images<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> bytes <span class="token operator">=</span> <span class="token keyword">await</span> image<span class="token punctuation">.</span><span class="token function">readAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">_uploadBytes</span><span class="token punctuation">(</span>
        bytes<span class="token punctuation">:</span> bytes<span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'images'</span></span><span class="token punctuation">,</span>
        progressCallback<span class="token punctuation">:</span> progressCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// allow partial image upload.</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Using Future.wait() will wait for all images to be uploaded concurrently.</span>
<span class="token keyword">final</span> imageURLs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>imageUploadTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
newJournal <span class="token operator">=</span> newJournal<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>images<span class="token punctuation">:</span> imageURLs<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <h3 id="이전-코드의-실행-순서" data-svelte-h="svelte-1r16s6i"><strong>이전 코드의 실행 순서</strong></h3> <ol data-svelte-h="svelte-jush8i"><li><p><strong>반복문 시작</strong></p> <ul><li>첫 번째 이미지를 선택합니다.</li> <li><code>await image.readAsBytes()</code> 를 호출합니다.</li></ul></li> <li><p><strong>이미지 바이트 읽기</strong></p> <ul><li>이 과정은 <strong>I/O 바운드 연산</strong> 입니다.</li> <li>Dart는 이 작업을 <strong>OS 파일 시스템에 위임(offload)</strong> 하고, 이벤트 큐의 다음 작업을 처리합니다.</li> <li>OS가 파일 읽기를 완료하면, 이벤트 루프가 이를 다시 받아 실행을 계속합니다.</li></ul></li></ol> <img src="/previous_1.jpg" width="80%" alt="previous_1.jpg"> <ol start="3" data-svelte-h="svelte-18ab6wb"><li><p><strong>이미지 업로드</strong></p> <ul><li><code>_uploadBytes</code> 를 호출하여 이미지를 서버에 업로드합니다.</li> <li>네트워크 작업 역시 <strong>OS/네트워크 스택에 위임</strong> 되므로, Dart는 다른 작업을 계속 처리할 수 있습니다.</li> <li>하지만 이벤트 루프는 <strong>이전 업로드가 완료될 때까지 다음 반복으로 넘어가지 않습니다.</strong></li></ul></li></ol> <img src="/previous_2.jpg" width="80%" alt="previous_2.jpg"> <ol start="4" data-svelte-h="svelte-1ea5ayd"><li><p><strong>URL 저장</strong></p> <ul><li>서버가 업로드된 이미지의 다운로드 URL을 반환합니다.</li> <li>Dart는 이 URL을 <code>imageURLs</code> 리스트에 추가합니다.</li></ul></li> <li><p><strong>이미지 2, 이미지 3에 대해 1~4를 반복</strong></p> <ul><li>Dart는 <strong>이전 이미지 업로드가 완료될 때까지 다음 이미지를 처리하지 않습니다.</strong></li> <li>즉, 이미지들이 <strong>순차적으로 처리되며, 하나의 작업이 완료되기 전까지 다음 작업이 블록(block)됩니다.</strong></li></ul></li></ol> <hr> <h3 id="개선된-코드의-실행-순서" data-svelte-h="svelte-q1sy0o"><strong>개선된 코드의 실행 순서</strong></h3> <ol data-svelte-h="svelte-3x96nc"><li><p><strong>메인 함수 시작</strong></p> <ul><li><code>image.map()</code> 내의 작업들이 <strong>이벤트 루프(event loop)</strong> 에 추가됩니다.</li></ul></li> <li><p><strong>각 <code>image.readAsBytes()</code> 실행 시작 (비동기 I/O)</strong></p> <ul><li>파일 I/O 연산(디스크 읽기) 작업이 시작됩니다.</li> <li>이는 <strong>이벤트 큐(event queue)</strong> 로 이동하며, <strong>마이크로태스크 큐(microtask queue)</strong> 에는 추가되지 않습니다.</li> <li>이벤트 루프는 <strong>이 작업이 완료될 때까지 대기하지 않고</strong> 다음 작업을 계속 실행합니다.</li></ul></li> <li><p><strong>각 <code>_uploadBytes()</code> 업로드 시작 (비동기 네트워크 I/O)</strong></p> <ul><li>네트워크에 데이터를 업로드하는 <strong>네트워크 바운드(network-bound) 연산</strong> 이 실행됩니다.</li> <li><strong>각 이미지의 읽기(read)가 완료되는 즉시</strong> 업로드가 시작됩니다.</li> <li>이전 코드와 달리, <strong>이미지들이 순차적으로 처리되는 것이 아니라 동시에(concurrently) 업로드됩니다.</strong></li></ul></li> <li><p><strong><code>Future.wait(imageUploadTasks)</code> 모든 업로드 완료 대기</strong></p> <ul><li><code>Future.wait()</code> 는 <strong>모든 이미지 업로드가 완료될 때까지 기다립니다.</strong></li> <li>모든 <code>Future</code> 들이 완료된 후, <code>imageURLs</code> 리스트에 업로드된 URL들이 저장됩니다.</li></ul></li></ol> <img src="/after_1.jpg" width="80%" alt="after_1.jpg"> <h1 id="source" data-svelte-h="svelte-leqc2o">Source</h1> <ul data-svelte-h="svelte-1lpkbqe"><li><a href="https://api.dart.dev/stable/latest/dart-async/index.html" rel="nofollow">https://api.dart.dev/stable/latest/dart-async/index.html</a></li> <li><a href="https://api.flutter.dev/flutter/dart-async/Future/wait.html" rel="nofollow">https://api.flutter.dev/flutter/dart-async/Future/wait.html</a></li> <li><a href="https://api.flutter.dev/flutter/dart-async/Future/then.html" rel="nofollow">https://api.flutter.dev/flutter/dart-async/Future/then.html</a></li> <li><a href="https://api.flutter.dev/flutter/dart-async/Future-class.html" rel="nofollow">https://api.flutter.dev/flutter/dart-async/Future-class.html</a></li> <li><a href="https://dart.dev/libraries/dart-async" rel="nofollow">https://dart.dev/libraries/dart-async</a></li> <li><a href="https://medium.com/dartlang/dart-asynchronous-programming-isolates-and-event-loops-bffc3e296a6a" rel="nofollow">https://medium.com/dartlang/dart-asynchronous-programming-isolates-and-event-loops-bffc3e296a6a</a></li></ul></div> </div></div> </div> 
			
			<script>
				{
					__sveltekit_14qnypk = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{publishedPosts:[{slug:"push_notifications",title:"How to send push notification",author:"jack",date:"2025. 05. 16",published:true,description:"Flutter 앱에서 사용자에게 알림을 보내는 방법에 대해 알아봅니다.",tags:["Firebase"]},{slug:"dart_async",title:"Dart asynchronous programming",author:"jack",description:"Dart에서 비동기를 구현하는 방식에 대해 알아보고 예시를 통해 학습 해봅니다.",published:true,date:"2025. 03. 27.",tags:["Dart"]},{slug:"understanding_hero_animation",title:"Understanding Flutter Hero animations process",description:"Flutter Hero animation에 대해 알아봅니다.",author:"jack",published:true,date:"2025. 02. 22.",tags:["Flutter"]},{slug:"dart_docs",title:"Effective Dart",description:"How to document my code.",author:"jack",published:true,date:"2025. 02. 17.",tags:["Dart"]},{slug:"union_types",title:"Union types in dart",description:"Union type에 대해 알아봅시다.",author:"jack",published:true,date:"2024. 12. 26.",tags:["Dart"]},{slug:"flutter_app_architecture2",title:"Flutter App Architecture(2) - Riverpod Architecture",author:"jack",description:"Riverpod 아키텍처에 대해 알아봅니다.",published:true,date:"2024. 12. 10.",tags:["Flutter"]},{slug:"flutter_app_architecture",title:"Flutter App Architecture(1) - MVVM",author:"jack",description:"MVVM(Model View ViewModel)아키텍처에 대해 알아봅니다.",published:true,date:"2024. 11. 23.",tags:["Flutter"]},{slug:"riverpod",title:"Flutter Package - Riverpod, State management tool",description:"Learn the core concept of provider and basic features of Riverpod.",author:"jack",published:true,date:"2024. 11. 08.",tags:["Flutter"]},{slug:"responsive_layout",title:"Responsive layout in Flutter(1)",description:"How to build responsive layout in flutter application. Learn about SafeArea, MediaQuery, LayoutBuilder and some best practices.",author:"jack",date:"2024. 10. 30.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge3",title:"Flutter UI Challenge(3)",description:"Learn some advanced usage of StatefulWidget, Widget builder, AnimatedWidget, and Transform.",author:"jack",date:"2024. 10. 16.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge2",title:"Flutter UI Challenge(2)",description:"Learn how to use StatefulWidgets and animate the changes of Widget. Widgets related to animations are Animation, AnimationController, Tween, AnimatedWidget and etc..",author:"jack",date:"2024. 10. 07.",published:true,tags:["Flutter"]},{slug:"flutter_ui_challenge",title:"Flutter UI Challenge(1)",description:"Learn the basic layouts with Flutter challenges posted by Andrea. Some basic layout of flutter includes Row, Column, Stack, Expanded, Padding, etc...",author:"jack",date:"2024. 10. 05.",published:true,tags:["Flutter"]},{slug:"flutter_boilerplate_code2",title:"new Flutter project의 main.dart 코드 파헤쳐보기(2)",description:"IDE를 이용해 만든 flutter project의 초기 main.dart 코드들을 보면서 StatelessWidget, StatefulWidget, key에 대해 알아봅니다.",author:"jack",date:"2024.09. 29.",published:true,tags:["Flutter"]},{slug:"flutter_boilerplate_code1",title:"new Flutter project의 main.dart 코드 파헤쳐보기(1)",description:"IDE를 이용해 만든 flutter project의 초기 main.dart 코드들을 보면서 StatelessWidget, StatefulWidget, key에 대해 알아봅니다.",author:"jack",date:"2024.09. 27.",published:true,tags:["Flutter"]},{slug:"branches",title:"Branches in Dart",author:"jack",description:"Dart에서 Branch(분기)로 코드의 흐름을 제어하는 방법에 대해 알아봅니다.",published:true,date:"2024. 09. 24.",tags:["Dart"]},{slug:"records",title:"Record type in Dart",description:"Record type에 대해 알아봅니다.",author:"jack",date:"2024.09. 23.",published:true,tags:["Dart"]},{slug:"terminologies2",title:"헷갈리는 용어들 정리(2) - parameter & argument",description:"Dart의 Function에 대해 알아보며 parameter 와 argument 의 정확한 의미에 대해 알아봅니다.",author:"jack",published:true,date:"2024. 09. 21.",tags:["Dart"]},{slug:"terminologies1",title:"헷갈리는 용어들 정리(1) - statement & expression",description:"Dart의 switch 공식문서를 살펴보며 statement와 expression의 정의와 차이점에 대해 알아봅니다.",author:"jack",published:true,date:"2024. 09. 12.",tags:["Dart"]},{slug:"exercise2",title:"Practice Dart - exercises for beginners (2)",description:"Exercises to practice Dart.",author:"jack",published:true,date:"2024. 09. 09.",tags:["Dart"]},{slug:"exercise1",title:"Practice Dart - exercises for beginners (1)",description:"Exercises to practice Dart.",author:"jack",published:true,date:"2024. 09. 04.",tags:["Dart"]},{slug:"deploy-steps",title:"Deploy SvelteKit + MDsveX with github pages step by step.",description:"Step by step guide on how to setup SvelteKit + MDsveX and deploy it with github pages. Optional settings such as useful remark plugins, project structure setup etc. are also introduced.",author:"jack",published:true,date:"2024. 04. 22.",tags:["SvelteKit","Mdsvex","Github"]}],tags:new Set(["Firebase","Dart","Flutter","SvelteKit","Mdsvex","Github"])},"uses":{}},null];

					Promise.all([
						import("../_app/immutable/entry/start.totQVT8G.js"),
						import("../_app/immutable/entry/app.ab6CEODS.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
	<script src="https://kit.fontawesome.com/56837ace2e.js" crossorigin="anonymous"></script>
</html>
